<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Definitive solution for converting LaTeX in Org mode to markdown | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Definitive solution for converting LaTeX in Org mode to markdown" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Finally, I switch to make4ht for converting LaTeX in Org mode to markdown." />
<meta property="og:description" content="Finally, I switch to make4ht for converting LaTeX in Org mode to markdown." />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2024/06/22/definitive-solution-for-converting-latex-in-org-mode-to-markdown.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2024/06/22/definitive-solution-for-converting-latex-in-org-mode-to-markdown.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-06-22T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Definitive solution for converting LaTeX in Org mode to markdown" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2024-06-22T00:00:00+08:00","datePublished":"2024-06-22T00:00:00+08:00","description":"Finally, I switch to make4ht for converting LaTeX in Org mode to markdown.","headline":"Definitive solution for converting LaTeX in Org mode to markdown","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2024/06/22/definitive-solution-for-converting-latex-in-org-mode-to-markdown.html"},"url":"https://jihuan-tian.github.io/computer/2024/06/22/definitive-solution-for-converting-latex-in-org-mode-to-markdown.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Definitive solution for converting LaTeX in Org mode to markdown</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-06-22T00:00:00+08:00" itemprop="datePublished">Jun 22, 2024 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/Org-mode">Org-mode</a>
          
            <a href="/tags/LaTeX">LaTeX</a>
          
            <a href="/tags/Markdown">Markdown</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Finally, I switch to <code class="language-plaintext highlighter-rouge">make4ht</code> for converting LaTeX in Org mode to markdown.</p>

<p>Previously, when I wanted to publish some Org contents including LaTeX math equations to either GitHub Jekyll blog (equations are rendered by MathJax and the kramdown grammar is used) or GitLab web page (equations are rendered by KaTeX), I followed this procedure:</p>

<ol>
  <li>Export Org mode contents to LaTeX.</li>
  <li>
    <p>Convert LaTeX to GFM markdown via pandoc. In this page, <code class="language-plaintext highlighter-rouge">--bibliography=&lt;bibtex-file&gt;</code> option is added to pandoc. Then Bibtex citations in the original LaTeX document will be formatted to similar text as in LaTeX, such as <code class="language-plaintext highlighter-rouge">(Steinbach 2007)</code> if the Chicago citation style is used. The list of references will be generated into something as below.</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code># References
    
&lt;div id="refs" class="references hanging-indent"&gt;
    
&lt;div id="ref-ErichsenEfficient1998" markdown="1"&gt;
    
Erichsen, Stefan, and Stefan A. Sauter. 1998. “Efficient Automatic
Quadrature in 3-d Galerkin Bem.” *Computer Methods in Applied Mechanics and Engineering*, Papers presented at the seventh conference on
numerical methods and computational mechanics in science and
engineering, 157 (3): 215–24.
&lt;https://doi.org/10.1016/S0045-7825(97)00236-3&gt;.
    
&lt;/div&gt;
    
&lt;div id="ref-SteinbachNumerical2007" markdown="1"&gt;
    
Steinbach, Olaf. 2007. *Numerical Approximation Methods for Elliptic Boundary Value Problems: Finite and Boundary Elements*. Springer Science
&amp; Business Media.
    
&lt;/div&gt;
    
&lt;/div&gt;
</code></pre></div>    </div>
  </li>
  <li>Use an <a href="/computer/2024/05/13/convert-org-mode-contents-to-markdown.html">Awk script</a> to convert LaTeX equation wrappers to be suitable for MathJax or KaTeX.</li>
</ol>

<p>Unfortunately, due some unknown cause, pandoc cannot process bibliography anymore and I don’t know if this is related to my system upgrade from Debian Bullseyes to Bookworm. Meanwhile, the markdown export functionality provided by Org mode is even poorer than pandoc. Since I do not want to invest time to write a markdown exporter in Elisp at the moment, I have also tried other alternatives, such as <code class="language-plaintext highlighter-rouge">TeXmacs</code> with the <a href="https://github.com/PikachuHy/texmacs-converter-tm2md/tree/master">tm2md</a> plugin, neither can bibliography be handled and the generated markdown text is far from satisfying. Finally, I resorted to <code class="language-plaintext highlighter-rouge">make4ht</code>, which converts LaTeX to html. So far as I know, <code class="language-plaintext highlighter-rouge">make4ht</code> is the best document conversion tool which can preserve the original LaTeX typesetting. Its command line usage is like this.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make4ht -f html5-css &lt;tex-file.tex&gt; "mathjax,fn-in"
bibtex &lt;tex-file.aux&gt;
make4ht -f html5-css &lt;tex-file.tex&gt; "mathjax,fn-in"
</code></pre></div></div>

<p>Then open the generated HTML file and use the following Elisp script to correct display equations:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">defun</span> <span class="nv">tjh/correct-make4ht</span> <span class="p">()</span>
  <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">replace-string</span> <span class="s">"\\begin {equation"</span> <span class="s">"\\begin{equation"</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">goto-char</span> <span class="p">(</span><span class="nv">point-min</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">replace-string</span> <span class="s">"\\end {equation"</span> <span class="s">"\\end{equation"</span><span class="p">))</span>
</code></pre></div></div>

<p>Finally, extract the main contents from the HTML file (including the table of contents, since the <code class="language-plaintext highlighter-rouge">[toc]</code> markdown directive is not recognized when the file extension is <code class="language-plaintext highlighter-rouge">html</code>) and add the markdown preamble. To prevent some HTML tags are processed by Jekyll first which makes further HTML rendering incorrect, the file should be saved with the <code class="language-plaintext highlighter-rouge">html</code> extension. It is fortunate that Liquid markup language is still supported. Hence, link to an existing post can be conveniently inserted by using the <code class="language-plaintext highlighter-rouge">post_url</code> command.</p>

<p>I’ve already wasted much time studying the usage of Org mode, pandoc and Awk etc., tuning their parameters, previewing and testing the conversion quality. Even though these tools give me the freedom and long term stability of my note and writing system, wasting time on tools instead of directly working on the project and solving problems is definitely a pitfall. To realize this point and make good balance between them, I have spent many years.</p>


  </div><a class="u-url" href="/computer/2024/06/22/definitive-solution-for-converting-latex-in-org-mode-to-markdown.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2024 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
