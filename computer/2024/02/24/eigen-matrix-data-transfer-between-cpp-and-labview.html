<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Eigen matrix data transfer between C++ and LabView | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Eigen matrix data transfer between C++ and LabView" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="When interfacing C++ and LabView, I need to process and manipulate the data array created in LabView with Eigen. There is no need to copy the whole array and wrapping the existing array into an Eigen object is enough and efficient. Eigen::Map should be used for this purpose." />
<meta property="og:description" content="When interfacing C++ and LabView, I need to process and manipulate the data array created in LabView with Eigen. There is no need to copy the whole array and wrapping the existing array into an Eigen object is enough and efficient. Eigen::Map should be used for this purpose." />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2024/02/24/eigen-matrix-data-transfer-between-cpp-and-labview.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2024/02/24/eigen-matrix-data-transfer-between-cpp-and-labview.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-02-24T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Eigen matrix data transfer between C++ and LabView" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2024-02-24T00:00:00+08:00","datePublished":"2024-02-24T00:00:00+08:00","description":"When interfacing C++ and LabView, I need to process and manipulate the data array created in LabView with Eigen. There is no need to copy the whole array and wrapping the existing array into an Eigen object is enough and efficient. Eigen::Map should be used for this purpose.","headline":"Eigen matrix data transfer between C++ and LabView","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2024/02/24/eigen-matrix-data-transfer-between-cpp-and-labview.html"},"url":"https://jihuan-tian.github.io/computer/2024/02/24/eigen-matrix-data-transfer-between-cpp-and-labview.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/font.css">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Eigen matrix data transfer between C++ and LabView</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-02-24T00:00:00+08:00" itemprop="datePublished">Feb 24, 2024 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/Eigen">Eigen</a>
          
            <a href="/tags/C++">C++</a>
          
            <a href="/tags/LabView">LabView</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>When interfacing C++ and LabView, I need to process and manipulate the data array created in LabView with Eigen. There is no need to copy the whole array and wrapping the existing array into an Eigen object is enough and efficient. <code class="language-plaintext highlighter-rouge">Eigen::Map</code> should be used for this purpose.</p>

<p>On the other hand, before integrating C++ with LabView, I need to test algorithms implemented in C++ and Eigen’s matrix type will be used instead of raw data array from LabView. Therefore, the C++ function should accept both scenarios. Hence, <code class="language-plaintext highlighter-rouge">Eigen::Ref</code> is used.</p>

<p>Convert a data pointer to an array to <code class="language-plaintext highlighter-rouge">Eigen::Map</code></p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;Eigen/Core&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;Eigen/Dense&gt;</span><span class="cp">
</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">Eigen</span><span class="p">;</span>

<span class="c1">// @p mat is a pointer to an array created in LabView, which is wrapped in an</span>
<span class="c1">// @p Eigen::Map object @p mat_out.</span>
<span class="kt">void</span>
<span class="nf">read_matrix_labview</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span>        <span class="o">*</span><span class="n">filename</span><span class="p">,</span>
                    <span class="kt">double</span>            <span class="o">*</span><span class="n">mat</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n_rows</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n_cols</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">char</span>        <span class="o">*</span><span class="n">comment_symbol</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Map</span><span class="o">&lt;</span><span class="n">MatrixXd</span><span class="p">,</span> <span class="n">Unaligned</span><span class="o">&gt;</span> <span class="n">mat_out</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">);</span>
  <span class="n">TSC</span><span class="o">::</span><span class="n">read_matrix</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
                   <span class="n">mat_out</span><span class="p">,</span>
                   <span class="n">n_rows</span><span class="p">,</span>
                   <span class="n">n_cols</span><span class="p">,</span>
                   <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">comment_symbol</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In the following function declaration, <code class="language-plaintext highlighter-rouge">Ref&lt;VectorXd&gt;</code> can either accept a mutable <code class="language-plaintext highlighter-rouge">VectorXd</code> object or a <code class="language-plaintext highlighter-rouge">Map&lt;VectorXd&gt;</code> object. If the argument is read-only, we should use <code class="language-plaintext highlighter-rouge">const Ref&lt;const VectorXd&gt;&amp;</code>.</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span>
<span class="nf">tsc_electronic_trap</span><span class="p">(</span><span class="n">Ref</span><span class="o">&lt;</span><span class="n">VectorXd</span><span class="o">&gt;</span>              <span class="n">trap_energies</span><span class="p">,</span>
                    <span class="n">Ref</span><span class="o">&lt;</span><span class="n">VectorXd</span><span class="o">&gt;</span>              <span class="n">trap_densities</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">Ref</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">VectorXd</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">temperatures</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">Ref</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">VectorXd</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">currents</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span>               <span class="n">temperature_ramp_rate</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span>               <span class="n">electrode_diameter</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span>               <span class="n">sample_thickness</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span>               <span class="n">attemp_to_jump_frequency</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span>               <span class="n">carrier_penetration_depth</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span>               <span class="n">valence_band_depth</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span>         <span class="n">energy_level_num</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">bool</span>                 <span class="n">is_near_measurement_electrode</span><span class="p">);</span>
</code></pre></div></div>

<p>The reason for the difference between mutable and const is described as follows.</p>

<ul>
  <li>The basic situation: usually we don’t already have a <code class="language-plaintext highlighter-rouge">Ref&lt;VectorXd&gt;</code> object to be passed to the function, but only pass a <code class="language-plaintext highlighter-rouge">VectorXd</code> or <code class="language-plaintext highlighter-rouge">Map&lt;VectorXd&gt;</code> to the above function. Then a temporary <code class="language-plaintext highlighter-rouge">Ref&lt;VectorXd&gt;</code> object will be created. Because it is an rvalue, it is const.</li>
  <li>If the function argument type is <code class="language-plaintext highlighter-rouge">Ref&lt;VectorXd&gt;&amp;</code>, it requires a mutable reference to the const temporary object, which is invalid. Hence, only <code class="language-plaintext highlighter-rouge">Ref&lt;VectorXd&gt;</code> is allowed.</li>
  <li>If the function argument type is <code class="language-plaintext highlighter-rouge">const Ref&lt;const VectorXd&gt;</code> or <code class="language-plaintext highlighter-rouge">const Ref&lt;const VectorXd&gt;&amp;</code>, both are grammatically correct. The former is pass-by-value with respect to the object <code class="language-plaintext highlighter-rouge">Ref&lt;const VectorXd&gt;</code>, while the latter is pass-by-reference. Here the <code class="language-plaintext highlighter-rouge">Ref</code> object is created for <code class="language-plaintext highlighter-rouge">VectorXd</code>, the memory of which has already been dynamically allocated. Therefore, <code class="language-plaintext highlighter-rouge">Ref&lt;VectorXd&gt;</code> itself is a small object. For <code class="language-plaintext highlighter-rouge">Ref&lt;Vector3d&gt;</code>, the memory for <code class="language-plaintext highlighter-rouge">Vector3d</code> is fixed and statically created, the entirety of which is a member of <code class="language-plaintext highlighter-rouge">Ref&lt;Vector3d&gt;</code>. Therefore, <code class="language-plaintext highlighter-rouge">Ref&lt;Vector3d&gt;</code> is relatively a large object and pass-by-reference is preferred. So we should use <code class="language-plaintext highlighter-rouge">const Ref&lt;const Vector3d&gt;&amp;</code>. For simplicity, for any type <code class="language-plaintext highlighter-rouge">T</code>, we only use <code class="language-plaintext highlighter-rouge">const Ref&lt;const T&gt;&amp;</code>.</li>
</ul>

<p>Reference: <a href="https://stackoverflow.com/a/21138316">https://stackoverflow.com/a/21138316</a></p>


  </div><a class="u-url" href="/computer/2024/02/24/eigen-matrix-data-transfer-between-cpp-and-labview.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://mastodon.social/@hypersingular"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#mastodon"></use></svg> <span class="username">hypersingular</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2025 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
