<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Noise reduction for recording using PulseAudio | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Noise reduction for recording using PulseAudio" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="When I perform sound recording using the microphone on my Logitech H151 headset as well as the default HDA Intel PCH sound card on my PC, there is too much noise. Then I use the following steps to reduce the noise level." />
<meta property="og:description" content="When I perform sound recording using the microphone on my Logitech H151 headset as well as the default HDA Intel PCH sound card on my PC, there is too much noise. Then I use the following steps to reduce the noise level." />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2024/04/06/noise-reduction-for-recording-using-pulseaudio.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2024/04/06/noise-reduction-for-recording-using-pulseaudio.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-04-06T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Noise reduction for recording using PulseAudio" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2024-04-06T00:00:00+08:00","datePublished":"2024-04-06T00:00:00+08:00","description":"When I perform sound recording using the microphone on my Logitech H151 headset as well as the default HDA Intel PCH sound card on my PC, there is too much noise. Then I use the following steps to reduce the noise level.","headline":"Noise reduction for recording using PulseAudio","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2024/04/06/noise-reduction-for-recording-using-pulseaudio.html"},"url":"https://jihuan-tian.github.io/computer/2024/04/06/noise-reduction-for-recording-using-pulseaudio.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/font.css">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/search/">Search</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Noise reduction for recording using PulseAudio</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-04-06T00:00:00+08:00" itemprop="datePublished">Apr 6, 2024 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/audio">audio</a>
          
            <a href="/tags/multimedia">multimedia</a>
          
            <a href="/tags/PulseAudio">PulseAudio</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>When I perform sound recording using the microphone on my Logitech H151 headset as well as the default HDA Intel PCH sound card on my PC, there is too much noise. Then I use the following steps to reduce the noise level.</p>

<ul>
  <li>
    <p>Check if <code class="language-plaintext highlighter-rouge">module-echo-cancel</code> is loaded by <code class="language-plaintext highlighter-rouge">PulseAudio</code>. Usually, it is not enabled by default. Therefore, the following command will return nothing.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacmd list-modules | <span class="nb">grep </span>module-echo-cancel
</code></pre></div>    </div>
  </li>
  <li>
    <p>At the moment, there are two audio input devices on my PC. Besides the input of the said sound card HDA Intel PCH, the other is the microphone in my Logitech C930C webcam. Therefore, I need to know the ALSA device name of HDA Intel PCH’s input by executing this command:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacmd list-sources  | <span class="nb">grep </span>name: | <span class="nb">grep </span>input
</code></pre></div>    </div>
  </li>
  <li>
    <p>Add the following lines in <code class="language-plaintext highlighter-rouge">/etc/pulseaudio/default.pa</code> to enable echo and noise cancellation for HDA Intel PCH.</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## When analog_gain_control=1, there will be distortion. Therefore, set it to 0.
## When digital_gain_control=1, automatic gain control is done in post processing by CPU.
.ifexists module-echo-cancel.so
load-module module-echo-cancel source_master=alsa_input.pci-0000_00_1b.0.analog-stereo aec_method=webrtc aec_args="analog_gain_control=0 digital_gain_control=1" source_name=echoCancel_source sink_name=echoCancel_sink
.endif
    
### Make some devices default
## set-default-sink echoCancel_sink
set-default-source echoCancel_source
</code></pre></div>    </div>

    <p>N.B.</p>

    <ol>
      <li>In <code class="language-plaintext highlighter-rouge">PulseAudio</code>, a <code class="language-plaintext highlighter-rouge">source</code> is a device that can emit digital audio stream to <code class="language-plaintext highlighter-rouge">PulseAudio</code>, e.g. microphone, line input, or some entity which is not a physical audio device but can still generate the audio stream. On the other hand, a <code class="language-plaintext highlighter-rouge">sink</code> is a device that can output digital audio stream from <code class="language-plaintext highlighter-rouge">PulseAudio</code>, such as speaker signal, headphone output, etc. Still, a <code class="language-plaintext highlighter-rouge">sink</code> may not be a physical audio device.</li>
      <li><code class="language-plaintext highlighter-rouge">source_master</code> in the above configuration specifies the sound <code class="language-plaintext highlighter-rouge">source</code>, which is the ALSA input device in the HDA Intel PCH sound card.</li>
      <li><code class="language-plaintext highlighter-rouge">source_name</code> in the above configuration is the <code class="language-plaintext highlighter-rouge">PulseAudio</code> device name. The audio stream from this device will be filtered to a small noise level.</li>
    </ol>
  </li>
  <li>
    <p>Restart <code class="language-plaintext highlighter-rouge">PulseAudio</code> server</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pulseaudio <span class="nt">-k</span>
pulseaudio <span class="nt">--start</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>References</p>
    <ul>
      <li><a href="https://wiki.archlinux.org/title/PulseAudio">https://wiki.archlinux.org/title/PulseAudio</a></li>
      <li><a href="https://www.linuxuprising.com/2020/09/how-to-enable-echo-noise-cancellation.html">https://www.linuxuprising.com/2020/09/how-to-enable-echo-noise-cancellation.html</a></li>
      <li>About beamforming
        <ul>
          <li><a href="https://www.freedesktop.org/wiki/Software/PulseAudio/Documentation/User/Modules/#index45h3">https://www.freedesktop.org/wiki/Software/PulseAudio/Documentation/User/Modules/#index45h3</a></li>
          <li><a href="https://arunraghavan.net/2016/06/beamforming-in-pulseaudio/">https://arunraghavan.net/2016/06/beamforming-in-pulseaudio/</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


  </div><script src="https://utteranc.es/client.js"
          repo="jihuan-tian/jihuan-tian.github.io"
          issue-term="pathname"
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>

  <a class="u-url" href="/computer/2024/04/06/noise-reduction-for-recording-using-pulseaudio.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2025 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
