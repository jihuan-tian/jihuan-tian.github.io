<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Manage scanned notes and sketches with LibreOffice Impress | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Manage scanned notes and sketches with LibreOffice Impress" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Just realized I can use LibreOffice Impress to collect my scattered scanned images for mathematical derivations on paper work journal and notebook as well as white board. Compared to LibreOffice Draw, the pages in Impress can be easily shifted and reorganized." />
<meta property="og:description" content="Just realized I can use LibreOffice Impress to collect my scattered scanned images for mathematical derivations on paper work journal and notebook as well as white board. Compared to LibreOffice Draw, the pages in Impress can be easily shifted and reorganized." />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2025/03/19/manage-scanned-notes-and-sketches-with-libreoffice-impress.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2025/03/19/manage-scanned-notes-and-sketches-with-libreoffice-impress.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-03-19T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Manage scanned notes and sketches with LibreOffice Impress" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2025-03-19T00:00:00+08:00","datePublished":"2025-03-19T00:00:00+08:00","description":"Just realized I can use LibreOffice Impress to collect my scattered scanned images for mathematical derivations on paper work journal and notebook as well as white board. Compared to LibreOffice Draw, the pages in Impress can be easily shifted and reorganized.","headline":"Manage scanned notes and sketches with LibreOffice Impress","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2025/03/19/manage-scanned-notes-and-sketches-with-libreoffice-impress.html"},"url":"https://jihuan-tian.github.io/computer/2025/03/19/manage-scanned-notes-and-sketches-with-libreoffice-impress.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/font.css">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Manage scanned notes and sketches with LibreOffice Impress</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-03-19T00:00:00+08:00" itemprop="datePublished">Mar 19, 2025 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/LibreOffice">LibreOffice</a>
          
            <a href="/tags/Bash">Bash</a>
          
            <a href="/tags/note-taking">note-taking</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Just realized I can use LibreOffice Impress to collect my scattered scanned images for mathematical derivations on paper work journal and notebook as well as white board. Compared to LibreOffice Draw, the pages in Impress can be easily shifted and reorganized.</p>

<ul>
  <li>
    <p>A VBA script has been written for inserting, positioning and resizing the images automatically in LibreOffice Impress.</p>

    <pre><code class="language-vba">' Multiple images can be selected and inserted into Impress in batch, one image
' per page.
Sub InsertImagesFromSelectedFolder()
    ' Get the current document (LibreOffice Draw)
    Dim oDoc As Object
    oDoc = ThisComponent
    
    ' Open the folder and check if it's a directory
    Dim files as Object
    files = SelectMultipleImages()
    
    ' Loop through each file in the folder
    Dim i As Integer
    For i = LBound(files) To UBound(files)
        Dim sFile as String
        sFile = files(i)
        ' Check if the file is an image (you can modify this to include more formats)
        If (InStr(LCase(sFile), ".png") &gt; 0 Or InStr(LCase(sFile), ".jpg") &gt; 0 Or InStr(LCase(sFile), ".jpeg") &gt; 0) Then
            ' Create a new page for each image by inserting into DrawPages
            Dim oPages As Object
            oPages = oDoc.getDrawPages()
            Dim oPage As Object
            oPage = oPages.insertNewByIndex(oPages.getCount())
            oPage.setName(ConvertFromURL(sFile))
    
            ' Create the image shape
            Dim oGraph As Object
            oGraph = oDoc.createInstance("com.sun.star.drawing.GraphicObjectShape")
            oGraph.GraphicURL = sFile
    
            ' Get the image size by callign a Bash script, because they cannot
            ' be acquired from LibreOffice VBA directly.
            CallBashScript("/usr/local/bin/scripts/call_get_img_size.sh", ConvertFromURL(sFile))
            Dim oInputFile as Object
            oInputFile = CreateUnoService("com.sun.star.ucb.SimpleFileAccess")
            Dim oInputStream as Object
            oInputStream = oInputFile.openFileRead("/tmp/libreoffice/img-size.txt")
            Dim sFileContent as String
            sFileContent = ReadInputStream(oInputStream)
            oInputStream.closeInput()
            Dim aSizeParts() as String
            aSizeParts = Split(sFileContent, "x")
    
	    ' Sclae the image with respect to the page size. N.B. The size unit
	    ' adopted by LibreOffice is 1/100 mm.
            Dim dpi As Integer
            dpi = 168
            Dim oBitmapSize As New com.sun.star.awt.Size
            oBitmapSize.Width = Val(Trim(aSizeParts(0))) / dpi * 25.4 * 100
            oBitmapSize.Height = Val(Trim(aSizeParts(1))) / dpi * 25.4 * 100
    
            Dim oNewSize As New com.sun.star.awt.Size    'New Image size     
            Dim dImageRatio As Double     'Ratio of the height to width
            Dim dPageRatio As Double      'Ratio of the height to width
    
            dImageRatio = CDbl(oBitmapSize.Height) / CDbl(oBitmapSize.Width)
            dPageRatio = CDbl(oPage.Height) / CDbl(oPage.Width)
    
            ' Compare the ratios to see which is wider, relatively speaking
            If oBitmapSize.Width &gt; oPage.Width OR oBitmapSize.Height &gt; oPage.Height Then
		If dPageRatio &gt; dImageRatio Then
                    oNewSize.Width  = oPage.Width
                    oNewSize.Height = CLng(CDbl(oPage.Width) * dImageRatio)
		Else
                    oNewSize.Width  = CLng(CDbl(oPage.Height) / dImageRatio)
                    oNewSize.Height = oPage.Height
		End If
            Else
		oNewSize = oBitmapSize
            End If
    
            ' Add the image to the current page.
            oGraph.SetSize(oNewSize)
    
            ' Center the image on the page.
            Dim oPosition as new com.sun.star.awt.Point
            oPosition.X = (oPage.Width - oNewSize.Width)/2
            oPosition.Y = (oPage.Height - oNewSize.Height)/2
            oGraph.SetPosition(oPosition)
    
            oPage.add(oGraph)
        End If
    Next i
End Sub
    
' Function to display the file picker dialog and return the selected folder
Function SelectMultipleImages() As Object
    Dim oFilePicker As Object
    Dim folderPath As String
    
    ' Create the file picker service
    oFilePicker = CreateUnoService("com.sun.star.ui.dialogs.FilePicker")
    
    ' Set dialog properties
    oFilePicker.setMultiSelectionMode (True)
    oFilePicker.setTitle("Select Folder with Images")
    oFilePicker.execute()
    
    SelectMultipleImages = oFilePicker.getSelectedFiles()
End Function
    
' Call a Bash script. LibreOffice VBA can only start a asynchronous process, so
' we need to wait for 1000 ms to let the script finish. Also note the argument
' list in the string passed to the Bash script does not need to be escaped.
Sub CallBashScript(sScriptPath As String, sArgs As String)
    Dim oShell As Object
    
    ' Create a Shell object and execute the command
    oShell = CreateUnoService("com.sun.star.system.SystemShellExecute")
    oShell.execute(sScriptPath, sArgs, 0)  ' The second parameter "0" is to run in the background
    Wait 1000
End Sub
    
' Read the content as a string from an input stream.
Function ReadInputStream(oInputStream As Object) As String
    Dim sContent As String
    Dim oTextStream As Object
    Dim aBytes() As Byte
    Dim nBytes As Integer
    
    ' Read data from input stream
    oTextStream = CreateUnoService("com.sun.star.io.TextInputStream")
    oTextStream.setInputStream(oInputStream)
    oTextStream.setEncoding("UTF-8") ' Adjust encoding if necessary
    
    ' Read the full content
    sContent = oTextStream.readLine()
    
    ' Return content as a string
    ReadInputStream = sContent
End Function
</code></pre>

    <p>The Bash script <code class="language-plaintext highlighter-rouge">call_get_img_size.sh</code> is as below. It calls <code class="language-plaintext highlighter-rouge">identify</code> to get the image information, from which we write the image size into a temporary file.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="si">$(</span>identify <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | gawk <span class="s1">'{if(match($0, /([[:digit:]]+)x([[:digit:]]+)/, res) != 0) print res[0];}'</span><span class="si">)</span> <span class="o">&gt;</span> /tmp/libreoffice/img-size.txt
</code></pre></div>    </div>
  </li>
  <li>
    <p>For eye-protection, the white background of each image is converted to light yellow, i.e. RGB 246, 240, 222, with the command line image editing tool ImageMagick.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
mogrify <span class="nt">-fuzz</span> 10% <span class="nt">-fill</span> <span class="s1">'rgb(246,240,222)'</span> <span class="nt">-opaque</span> white <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span>
</code></pre></div>    </div>
  </li>
  <li>The handwriting in each inserted image can be further edited with Wacom+Krita.</li>
  <li>The whole Impress document or its internal bookmarks can be further linked into Org mode, so that they can be categorized and tagged in the <a href="/thoughts/2024/10/01/%E5%9F%BA%E4%BA%8E%E5%8D%A1%E7%89%87%E7%AC%94%E8%AE%B0%E5%86%99%E4%BD%9C%E6%B3%95%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0%E6%94%B9%E8%BF%9B.html">Zettelkasten</a> note system.</li>
</ul>


  </div><a class="u-url" href="/computer/2025/03/19/manage-scanned-notes-and-sketches-with-libreoffice-impress.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://mastodon.social/@hypersingular"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#mastodon"></use></svg> <span class="username">hypersingular</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2025 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
