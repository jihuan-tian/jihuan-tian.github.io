<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Keep home network reachable for remote working | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Keep home network reachable for remote working" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’m using China Telecom’s network with dynamic IP, through which I can provide my family several services, such as WebDAV based Joplin note system, music library that can be accessed from the Foobar music player on iOS, HTTPS based Calibre Ebooks, etc. However, the network is unstable due to three factors:" />
<meta property="og:description" content="I’m using China Telecom’s network with dynamic IP, through which I can provide my family several services, such as WebDAV based Joplin note system, music library that can be accessed from the Foobar music player on iOS, HTTPS based Calibre Ebooks, etc. However, the network is unstable due to three factors:" />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2025/02/15/keep-home-network-reachable-for-remote-working.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2025/02/15/keep-home-network-reachable-for-remote-working.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-02-15T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Keep home network reachable for remote working" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2025-02-15T00:00:00+08:00","datePublished":"2025-02-15T00:00:00+08:00","description":"I’m using China Telecom’s network with dynamic IP, through which I can provide my family several services, such as WebDAV based Joplin note system, music library that can be accessed from the Foobar music player on iOS, HTTPS based Calibre Ebooks, etc. However, the network is unstable due to three factors:","headline":"Keep home network reachable for remote working","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2025/02/15/keep-home-network-reachable-for-remote-working.html"},"url":"https://jihuan-tian.github.io/computer/2025/02/15/keep-home-network-reachable-for-remote-working.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/font.css">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet">
  <script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=67ba859acde8790019eafb38&product=inline-share-buttons' async='async'></script><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Keep home network reachable for remote working</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-02-15T00:00:00+08:00" itemprop="datePublished">Feb 15, 2025 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/network">network</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I’m using China Telecom’s network with dynamic IP, through which I can provide my family several services, such as WebDAV based Joplin note system, music library that can be accessed from the Foobar music player on iOS, HTTPS based Calibre Ebooks, etc. However, the network is unstable due to three factors:</p>

<ol>
  <li>If the fiber optical modem keeps on working without being shut down for more than one week, it tends to freeze sporadically.</li>
  <li>Sometimes, especially in the early morning around 4 or 5 am, the public IP for my home is lost and the modem does not try to acquire a new one.</li>
  <li>The dynamic IP will also change irregularly, which requires to change the dynamic DNS configuration.</li>
</ol>

<p>Therefore, I’ve created a bash script and scheduled its execution in crontab on my home Debian server. It periodically checks if the public network is reachable by pinging a web server:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping -c 3 -w 3 www.baidu.com &gt; /dev/null 2&gt;&amp;1
</code></pre></div></div>

<p>If there is no error, I’ll use <code class="language-plaintext highlighter-rouge">curl -s ifconfig.me</code> to get the current public IP and compare it with the old one. If the IP has changed, I’ll reconnect VPN and update this new public IP to the dynamic DNS configuration.</p>

<p>If <code class="language-plaintext highlighter-rouge">www.baidu.com</code> is not reachable, I can use <code class="language-plaintext highlighter-rouge">python-miio</code> to switch off then turn on my Xiaomi smart WIFI plug which powers the modem. The model type of this plug is <code class="language-plaintext highlighter-rouge">cuco.plug.v3</code>, which should be controlled via the <code class="language-plaintext highlighter-rouge">genericmiot</code> command provided by <code class="language-plaintext highlighter-rouge">python-miio</code>. This solution is much easier than Home Assistant, without bothering to install a new operating system. In case there might be unexpected frequent plug switching, I’ll only enable this operation when I travel outside.</p>

<p><strong>Installation and usage of <code class="language-plaintext highlighter-rouge">python-miio</code></strong></p>

<ul>
  <li>
    <p>Install the Git version of <code class="language-plaintext highlighter-rouge">python-miio</code> instead of the default one.</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install git+https://github.com/rytilahti/python-miio.git
</code></pre></div>    </div>
  </li>
  <li>Execute the command <code class="language-plaintext highlighter-rouge">miiocli cloud</code>, then type in the user name and password registered for Xiaomi APP. From the output, we will get the token and MAC address of the plug.</li>
  <li>Bind the MAC address with a fixed IP in the WIFI router.</li>
  <li>
    <p>Get the plug device status:</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>miiocli genericmiot --ip &lt;IP&gt; --token &lt;token&gt; status
</code></pre></div>    </div>
  </li>
  <li>
    <p>List available actions provided by the plug:</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>miiocli genericmiot --ip &lt;IP&gt; --token &lt;token&gt; actions
</code></pre></div>    </div>

    <p>Only one action <code class="language-plaintext highlighter-rouge">toggle</code> is supported.</p>
  </li>
  <li>
    <p>Execute an action:</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>miiocli genericmiot --ip &lt;IP&gt; --token &lt;token&gt; call &lt;action-name&gt;
</code></pre></div>    </div>
  </li>
  <li>
    <p>Set on/off of the plug:</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>miiocli genericmiot --ip &lt;IP&gt; --token &lt;token&gt; set switch_on_2_1 True|False
</code></pre></div>    </div>

    <p><code class="language-plaintext highlighter-rouge">switch_on_2_1</code> is the property name.</p>
  </li>
</ul>


  </div><div class="sharethis-inline-share-buttons"></div>

  <script src="https://utteranc.es/client.js"
          repo="jihuan-tian/jihuan-tian.github.io"
          issue-term="pathname"
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>

  <a class="u-url" href="/computer/2025/02/15/keep-home-network-reachable-for-remote-working.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://mastodon.social/@hypersingular"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#mastodon"></use></svg> <span class="username">hypersingular</span></a></li><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2025 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
