<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Portable hard disk IO problem during rsync | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Portable hard disk IO problem during rsync" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Yesterday, when making data backup to my portable hard disk West Digital My Passport WD20, I ran about rsync IO problem, which was probably caused by damaged sectors. Then I used the following procedures to check and repair bad blocks." />
<meta property="og:description" content="Yesterday, when making data backup to my portable hard disk West Digital My Passport WD20, I ran about rsync IO problem, which was probably caused by damaged sectors. Then I used the following procedures to check and repair bad blocks." />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2022/12/29/portable-hard-disk-io-problem-during-rsync.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2022/12/29/portable-hard-disk-io-problem-during-rsync.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-12-29T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Portable hard disk IO problem during rsync" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2022-12-29T00:00:00+08:00","datePublished":"2022-12-29T00:00:00+08:00","description":"Yesterday, when making data backup to my portable hard disk West Digital My Passport WD20, I ran about rsync IO problem, which was probably caused by damaged sectors. Then I used the following procedures to check and repair bad blocks.","headline":"Portable hard disk IO problem during rsync","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2022/12/29/portable-hard-disk-io-problem-during-rsync.html"},"url":"https://jihuan-tian.github.io/computer/2022/12/29/portable-hard-disk-io-problem-during-rsync.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/font.css">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Portable hard disk IO problem during rsync</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-12-29T00:00:00+08:00" itemprop="datePublished">Dec 29, 2022 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/Linux">Linux</a>
          
            <a href="/tags/command">command</a>
          
            <a href="/tags/hardware">hardware</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Yesterday, when making data backup to my portable hard disk West Digital My Passport WD20, I ran about <code class="language-plaintext highlighter-rouge">rsync</code> IO problem, which was probably caused by damaged sectors. Then I used the following procedures to check and repair bad blocks.</p>

<ol>
  <li>
    <p>Use the <code class="language-plaintext highlighter-rouge">dmesg</code> command (for printing or controlling the kernel ring buffer) to check the hard disk errors. It is clear that there are many critical medium errors on the device <code class="language-plaintext highlighter-rouge">/dev/sdc</code>.</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[161861.101324] sd 6:0:0:0: [sdc] tag#0 FAILED Result: hostbyte=DID_OK driverbyte=DRIVER_SENSE cmd_age=6s
[161861.101330] sd 6:0:0:0: [sdc] tag#0 Sense Key : Medium Error [current] 
[161861.101333] sd 6:0:0:0: [sdc] tag#0 Add. Sense: Unrecovered read error
[161861.101337] sd 6:0:0:0: [sdc] tag#0 CDB: Read(10) 28 00 9e 00 33 40 00 00 c8 00
[161861.101341] blk_update_request: critical medium error, dev sdc, sector 2650813248 op 0x0:(READ) flags 0x80700 phys_seg 25 prio class 0
    
[163206.145345] sd 6:0:0:0: [sdc] tag#0 FAILED Result: hostbyte=DID_OK driverbyte=DRIVER_SENSE cmd_age=3s
[163206.145351] sd 6:0:0:0: [sdc] tag#0 Sense Key : Medium Error [current] 
[163206.145354] sd 6:0:0:0: [sdc] tag#0 Add. Sense: Unrecovered read error
[163206.145358] sd 6:0:0:0: [sdc] tag#0 CDB: Read(10) 28 00 9e 80 08 58 00 00 08 00
[163206.145363] blk_update_request: critical medium error, dev sdc, sector 2659190872 op 0x0:(READ) flags 0x3000 phys_seg 1 prio class 0
[163206.145427] EXT4-fs error (device dm-7): __ext4_get_inode_loc_noinmem:4506: inode #83102912: block 332398827: comm ls: unable to read itable block
</code></pre></div>    </div>
  </li>
  <li>
    <p>Since the ext4 volume on the hard disk is encrypted by VeraCrypt, we should check to which system device the VeraCrypt volume is mapped.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># -t: run veracrypt in text mode.</span>
<span class="c"># -l: list mounted volumes.</span>
veracrypt <span class="nt">-t</span> <span class="nt">-l</span>
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 3: /dev/sdc /dev/mapper/veracrypt3 - 
</code></pre></div>    </div>

    <p>No.3 is assigned to the volume. The displayed system device <code class="language-plaintext highlighter-rouge">/dev/mapper/veracrypt3</code> is only a symbolic link, which is associated with <code class="language-plaintext highlighter-rouge">/dev/dm-7</code>:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> /dev/mapper/veracrypt3
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lrwxrwxrwx 1 root root 7 Dec 29 10:15 /dev/mapper/veracrypt3 -&gt; ../dm-7
</code></pre></div>    </div>
  </li>
  <li>
    <p>Use <code class="language-plaintext highlighter-rouge">testdisk</code> to check the addresses of superblock backups and the block size, in case the default super lock is damaged and needs a repair.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>testdisk /dev/dm-7
</code></pre></div>    </div>

    <p><img src="/figures/2022-12-29_10-04-22-testdisk-for-superblock.png" alt="img" /></p>
  </li>
  <li>
    <p>Umount the volume before checking and repairing it.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>umount /media/backup2
</code></pre></div>    </div>
  </li>
  <li>
    <p>Check and repair the volume using the command <code class="language-plaintext highlighter-rouge">fsck.ext4</code>, which actually executes <code class="language-plaintext highlighter-rouge">e2fsck</code>.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fsck.ext4 <span class="nt">-p</span> <span class="nt">-c</span> /dev/dm-7
</code></pre></div>    </div>

    <p>If the default superblock is damaged, run the command</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fsck.ext4 <span class="nt">-p</span> <span class="nt">-c</span> <span class="nt">-b</span> superblock <span class="nt">-B</span> blocksize /dev/dm-7
</code></pre></div>    </div>

    <p>Meaning of the command options of <code class="language-plaintext highlighter-rouge">e2fsck</code>:</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-b Use an alternative superblock instead of the default one, if the default one is damaged.
-B superblock specify the superblock size
-c This  option  causes e2fsck to use badblocks(8) program to do a read-only scan of the device in order to find any bad blocks.  If any bad blocks are found, they are added to the bad block inode to prevent them from being allocated to a file or directory.
-p Automatically  repair ("preen") the file system.  This option will cause e2fsck to automatically fix any filesystem problems that can be safely fixed without human intervention.  If e2fsck discovers a problem which may require the system administrator to take additional corrective action, e2fsck will print a description of the problem and then exit with the value 4  logically  or'ed  into the exit code.
</code></pre></div>    </div>
  </li>
</ol>


  </div><a class="u-url" href="/computer/2022/12/29/portable-hard-disk-io-problem-during-rsync.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2024 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
