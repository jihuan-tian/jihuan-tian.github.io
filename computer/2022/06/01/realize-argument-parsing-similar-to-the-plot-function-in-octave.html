<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Realize argument parsing similar to the “plot” function in Octave | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Realize argument parsing similar to the “plot” function in Octave" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In GNU Octave, the frequently used plot function has several overloaded versions:" />
<meta property="og:description" content="In GNU Octave, the frequently used plot function has several overloaded versions:" />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2022/06/01/realize-argument-parsing-similar-to-the-plot-function-in-octave.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2022/06/01/realize-argument-parsing-similar-to-the-plot-function-in-octave.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-01T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Realize argument parsing similar to the “plot” function in Octave" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2022-06-01T00:00:00+08:00","datePublished":"2022-06-01T00:00:00+08:00","description":"In GNU Octave, the frequently used plot function has several overloaded versions:","headline":"Realize argument parsing similar to the “plot” function in Octave","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2022/06/01/realize-argument-parsing-similar-to-the-plot-function-in-octave.html"},"url":"https://jihuan-tian.github.io/computer/2022/06/01/realize-argument-parsing-similar-to-the-plot-function-in-octave.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/font.css">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Realize argument parsing similar to the &quot;plot&quot; function in Octave</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-06-01T00:00:00+08:00" itemprop="datePublished">Jun 1, 2022 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/Octave">Octave</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In GNU Octave, the frequently used <code class="language-plaintext highlighter-rouge">plot</code> function has several overloaded versions:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- : plot (Y)
-- : plot (X, Y)
-- : plot (X, Y, FMT)
-- : plot (..., PROPERTY, VALUE, ...)
-- : plot (X1, Y1, ..., XN, YN)
-- : plot (HAX, ...)
-- : H = plot (...)
</code></pre></div></div>

<p>The arguments passed to <code class="language-plaintext highlighter-rouge">plot</code> have two main features as below, which make its function calling very flexible.</p>

<ol>
  <li>The argument list has a variable length.</li>
  <li>After numeric parameters, such as <code class="language-plaintext highlighter-rouge">HAX</code>, <code class="language-plaintext highlighter-rouge">X</code> and <code class="language-plaintext highlighter-rouge">Y</code>, there are multiple of <code class="language-plaintext highlighter-rouge">PROPERTY-VALUE</code> pairs.</li>
</ol>

<p>In my previous projects, when I wrote a function requiring different combinations of arguments, I would use <code class="language-plaintext highlighter-rouge">varargin</code> as its formal parameter, which wraps the list of input arguments in a cell array. Depending on the length of <code class="language-plaintext highlighter-rouge">varargin</code>, different parsing schemes were implemented.</p>

<pre class="src src-octave"><span style="color: #859900;">function</span> <span style="color: #268bd2;">foo</span>(varargin)
  <span style="color: #859900;">switch</span> (length(varargin))
    <span style="color: #859900;">case</span> 1<span style="color: #859900;">:</span>
    <span style="color: #859900;">case</span> 2<span style="color: #859900;">:</span>
    <span style="color: #859900;">case</span> 3<span style="color: #859900;">:</span>
  <span style="color: #859900;">endswitch</span>
<span style="color: #859900;">endfunction</span>
</pre>

<p>As an alternative, I might also explicitly list all the possible parameters in the function’s signature. Then, inside the function body, I used the <code class="language-plaintext highlighter-rouge">exist</code> function to check their availability and assigned default values to the missing variables.</p>

<pre class="src src-octave"><span style="color: #859900;">function</span> <span style="color: #268bd2;">foo</span>(image_handle<span style="color: #859900;">,</span> file_name<span style="color: #859900;">,</span> line_color)
  <span style="color: #859900;">if</span> (<span style="color: #859900;">!</span>exist(<span style="color: #2aa198;">"image_handle"</span><span style="color: #859900;">,</span> <span style="color: #2aa198;">"var"</span>))
    <span style="color: #93a1a1; font-style: italic;">## Assign the default value to @p image_handle with the current figure</span>
    <span style="color: #93a1a1; font-style: italic;">## handle.</span>
    image_handle <span style="color: #859900;">=</span> gcf<span style="color: #859900;">;</span>
  <span style="color: #859900;">endif</span>

  <span style="color: #859900;">if</span> (<span style="color: #859900;">!</span>exist(<span style="color: #2aa198;">"file_name"</span><span style="color: #859900;">,</span> <span style="color: #2aa198;">"var"</span>))
    <span style="color: #93a1a1; font-style: italic;">## Default image file for saving.</span>
    file_name <span style="color: #859900;">=</span> <span style="color: #2aa198;">"output.png"</span><span style="color: #859900;">;</span>
  <span style="color: #859900;">endif</span>

  <span style="color: #859900;">if</span> (<span style="color: #859900;">!</span>exist(<span style="color: #2aa198;">"line_color"</span><span style="color: #859900;">,</span> <span style="color: #2aa198;">"var"</span>))
    line_color <span style="color: #859900;">=</span> <span style="color: #2aa198;">"r"</span><span style="color: #859900;">;</span>
  <span style="color: #859900;">endif</span>
<span style="color: #859900;">endfunction</span>
</pre>

<p>It is obvious that the first method above requires lots of code to write, if there are many cases to be handled. For the second method, all the parameters are locked to their positions in the function’s signature, which is not flexible. Therefore, a new programming pattern is needed in order to implement a function similar to the internal function <code class="language-plaintext highlighter-rouge">plot</code>.</p>

<p>To solve this problem, Octave’s <code class="language-plaintext highlighter-rouge">parseparams</code> and <code class="language-plaintext highlighter-rouge">inputParser</code> class can be used. As shown in the following example code for plotting support points in a finite element cell, I pass <code class="language-plaintext highlighter-rouge">varargin</code> firstly to <code class="language-plaintext highlighter-rouge">parseparams</code>. It will separate the parameter list into two groups <code class="language-plaintext highlighter-rouge">reg</code> and <code class="language-plaintext highlighter-rouge">prop</code>. <code class="language-plaintext highlighter-rouge">reg</code> stores all the leading numeric arguments, while <code class="language-plaintext highlighter-rouge">prop</code> stores the remaining ones, the first of which should be a string. In my case, there is only one optional leading numeric parameter, which is the figure handle. Therefore, by checking the length of <code class="language-plaintext highlighter-rouge">reg</code>, figure handle can be obtained from the argument or set to the current figure via <code class="language-plaintext highlighter-rouge">gcf</code>.</p>

<p>Next, an <code class="language-plaintext highlighter-rouge">inputParser</code> object <code class="language-plaintext highlighter-rouge">p</code> is created for parsing and extracting both required parameters and parameter-value pairs. Note that each call of the parameter adding member function, like <code class="language-plaintext highlighter-rouge">p.addRequired</code> and <code class="language-plaintext highlighter-rouge">p.addParameter</code>, a function handle is passed as the last argument, which is responsible for user input validation. This is consistent with the spirit of defensive programming and makes our code more robust. Moreover, a default value should be provided for defining a parameter-value pair.</p>

<p>Finally, to run the parser <code class="language-plaintext highlighter-rouge">p</code>, call its member function <code class="language-plaintext highlighter-rouge">parse</code> on the unwrapped cell array <code class="language-plaintext highlighter-rouge">prop{:}</code>. The calling convention of <code class="language-plaintext highlighter-rouge">plot_support_points</code> now becomes consistent with <code class="language-plaintext highlighter-rouge">plot</code>.</p>

<pre class="src src-octave"><span style="color: #859900;">function</span> <span style="color: #268bd2;">plot_support_points</span>(varargin)
  <span style="color: #93a1a1; font-style: italic;">## The function @p parseparams is used for splitting the argument</span>
  <span style="color: #93a1a1; font-style: italic;">## list into figure handle part and the remaining part.</span>
  [reg<span style="color: #859900;">,</span> prop] <span style="color: #859900;">=</span> parseparams(varargin)<span style="color: #859900;">;</span>

  <span style="color: #859900;">if</span> (length(reg) <span style="color: #859900;">&gt;</span> 0)
    h <span style="color: #859900;">=</span> reg(1)<span style="color: #859900;">;</span>
  <span style="color: #859900;">else</span>
    h <span style="color: #859900;">=</span> gcf<span style="color: #859900;">;</span>
  <span style="color: #859900;">endif</span>

  p <span style="color: #859900;">=</span> inputParser()<span style="color: #859900;">;</span>
  p.FunctionName <span style="color: #859900;">=</span> <span style="color: #2aa198;">"plot_support_points"</span><span style="color: #859900;">;</span>
  p.addRequired(<span style="color: #2aa198;">"data_file"</span><span style="color: #859900;">,</span> @ischar)<span style="color: #859900;">;</span>
  val_float <span style="color: #859900;">=</span> @(x) isscalar(x) <span style="color: #859900;">&amp;&amp;</span> isfloat(x)<span style="color: #859900;">;</span>
  p.addParameter(<span style="color: #2aa198;">"offx"</span><span style="color: #859900;">,</span> 0.02<span style="color: #859900;">,</span> val_float)<span style="color: #859900;">;</span>
  p.addParameter(<span style="color: #2aa198;">"offy"</span><span style="color: #859900;">,</span> 0.02<span style="color: #859900;">,</span> val_float)<span style="color: #859900;">;</span>
  p.addParameter(<span style="color: #2aa198;">"marker"</span><span style="color: #859900;">,</span> <span style="color: #2aa198;">"o"</span><span style="color: #859900;">,</span> @ischar)<span style="color: #859900;">;</span>
  p.addParameter(<span style="color: #2aa198;">"markersize"</span><span style="color: #859900;">,</span> 12<span style="color: #859900;">,</span> val_float)<span style="color: #859900;">;</span>
  p.addParameter(<span style="color: #2aa198;">"markerfacecolor"</span><span style="color: #859900;">,</span> <span style="color: #2aa198;">"r"</span><span style="color: #859900;">,</span> @ischar)<span style="color: #859900;">;</span>
  p.addParameter(<span style="color: #2aa198;">"markeredgecolor"</span><span style="color: #859900;">,</span> <span style="color: #2aa198;">"r"</span><span style="color: #859900;">,</span> @ischar)<span style="color: #859900;">;</span>
  p.addParameter(<span style="color: #2aa198;">"labelsize"</span><span style="color: #859900;">,</span> 18<span style="color: #859900;">,</span> val_float)<span style="color: #859900;">;</span>

  p.parse(prop{<span style="color: #859900;">:</span>})<span style="color: #859900;">;</span>
<span style="color: #859900;">endfunction</span>
</pre>


  </div><a class="u-url" href="/computer/2022/06/01/realize-argument-parsing-similar-to-the-plot-function-in-octave.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2025 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
