<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Encrypted communication via Jami | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Encrypted communication via Jami" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jami is a GPL licensed communication tool with end-to-end encryption, which can be used for sending instant messages, making audio calls and holding video conferences with family members or friends. For those users concerned about data safety and communication privacy, Jami is an ideal and definitive choice." />
<meta property="og:description" content="Jami is a GPL licensed communication tool with end-to-end encryption, which can be used for sending instant messages, making audio calls and holding video conferences with family members or friends. For those users concerned about data safety and communication privacy, Jami is an ideal and definitive choice." />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2023/06/11/encrypted-communication-via-jami.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2023/06/11/encrypted-communication-via-jami.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-06-11T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Encrypted communication via Jami" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2023-06-11T00:00:00+08:00","datePublished":"2023-06-11T00:00:00+08:00","description":"Jami is a GPL licensed communication tool with end-to-end encryption, which can be used for sending instant messages, making audio calls and holding video conferences with family members or friends. For those users concerned about data safety and communication privacy, Jami is an ideal and definitive choice.","headline":"Encrypted communication via Jami","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2023/06/11/encrypted-communication-via-jami.html"},"url":"https://jihuan-tian.github.io/computer/2023/06/11/encrypted-communication-via-jami.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Comment out the default sorted categories. -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--         <a class="page-link" href="/about/">About</a> -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--         <a class="page-link" href="/computer/">Computer</a> -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--         <a class="page-link" href="/math/">Math</a> -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--         <a class="page-link" href="/tags/">Tags</a> -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--         <a class="page-link" href="/thoughts/">Thoughts</a> -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          <!---->
          <!--      -->
          <!---->
          <!--      -->
          <!---->
          
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Encrypted communication via Jami</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-06-11T00:00:00+08:00" itemprop="datePublished">Jun 11, 2023 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/Jami">Jami</a>
          
            <a href="/tags/network">network</a>
          
            <a href="/tags/security">security</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Jami is a GPL licensed communication tool with end-to-end encryption, which can be used for sending instant messages, making audio calls and holding video conferences with family members or friends. For those users concerned about data safety and communication privacy, Jami is an ideal and definitive choice.</p>

<p>Even though Jami claims to be a p2p communication tool, it still needs to join a public distributed network, i.e. <a href="https://en.wikipedia.org/wiki/Distributed_hash_table">distributed hash table</a> (DHT), as an independent node to announce the availability and connectivity of our accounts as well as acquiring the knowledge about other nodes. When a Jami client starts for the first time, it tries to connect to a bootstrap node <code class="language-plaintext highlighter-rouge">bootstrap.jami.net:4222</code>, from which a persistent cache will be built storing the node information. In case this server is not accessible in the future, I need to setup my own <a href="https://github.com/savoirfairelinux/opendht">OpenDHT</a> server.</p>

<p>Another issue is peers communicating via Jami are usually hidden from one another behind their respective firewalls or Wifi routers. Then another server with a public IP is necessary to bridge the peers by relaying the data stream during communication. This is called the TURN server. The default TURN server provided by Jami is <code class="language-plaintext highlighter-rouge">turn.jami.net</code>, with username <code class="language-plaintext highlighter-rouge">ring</code>, password <code class="language-plaintext highlighter-rouge">ring</code>, and realm <code class="language-plaintext highlighter-rouge">ring</code>. However, using this third-party server cannot ensure communication quality, especially when we need high resolution video calls. Meanwhile, the accessibility to this server cannot be ensured in the long run. Therefore, I also need to setup my own TURN server.</p>

<p>I have two cascading Wifi routers in my home, one is provided by the ISP, whose Wifi functionality is not stable and is actually disabled; the other is my own router providing the actual Wifi network across the room. Because the WLAN port has been assigned a dynamic public IP by the ISP, setting up the said TURN server is feasible. Even though my server is behind the two routers, port mapping can be enabled to expose my server to the outside world.</p>

<h1 id="setup-opendht-server">Setup OpenDHT server</h1>

<ul>
  <li>Install the <code class="language-plaintext highlighter-rouge">dhtnode</code> package from Debian.</li>
  <li>
    <p>Edit <code class="language-plaintext highlighter-rouge">/etc/default/dhtnode</code>, let the local OpenDHT node as a daemon listen at the port <code class="language-plaintext highlighter-rouge">&lt;opendht-port&gt;</code>, without connecting to another bootstrap server, i.e. without specifying the <code class="language-plaintext highlighter-rouge">-b</code> option. This option should only be used from an <code class="language-plaintext highlighter-rouge">opendht</code> node as a client.</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DHT_ARGS=-p &lt;opendht-port&gt;
</code></pre></div>    </div>

    <p>Other command line options for <code class="language-plaintext highlighter-rouge">dhtnode</code> which may be useful:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">-p</code>: local UDP port to bind. The default value is 4222.</li>
      <li><code class="language-plaintext highlighter-rouge">-n</code>: specify a network id (integer). Nodes with different network ids won’t talk to each other. Defaults to the main public network (network id 0). However, there is no place to specify this argument in Jami, I do not use it in my configuration.</li>
      <li><code class="language-plaintext highlighter-rouge">-v</code>: enables logging, to standard output by default</li>
      <li><code class="language-plaintext highlighter-rouge">-L</code>: logs to syslog</li>
      <li><code class="language-plaintext highlighter-rouge">-l</code>: logs to a specific file</li>
    </ul>
  </li>
  <li>
    <p>Start the <code class="language-plaintext highlighter-rouge">dhtnode</code></p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl start dhtnode
</code></pre></div>    </div>
  </li>
  <li>
    <p>Automatically start at system boot:</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl enable dhtnode
</code></pre></div>    </div>
  </li>
</ul>

<p>More information can be found here:</p>

<ul>
  <li><a href="https://github.com/savoirfairelinux/opendht/wiki/Running-a-node-with-dhtnode">https://github.com/savoirfairelinux/opendht/wiki/Running-a-node-with-dhtnode</a></li>
  <li><a href="https://stackoverflow.com/questions/60425311/how-to-connect-to-peers-in-opendht">https://stackoverflow.com/questions/60425311/how-to-connect-to-peers-in-opendht</a></li>
</ul>

<h1 id="setup-turn-server">Setup TURN server</h1>

<ul>
  <li>Install the <code class="language-plaintext highlighter-rouge">coturn</code> package from Debian.</li>
  <li>
    <p>Edit configuration file <code class="language-plaintext highlighter-rouge">/etc/turnserver.conf</code>, where I disabled TCP and UDP protocol and only keep TLS and DTLS, which are safer. The <code class="language-plaintext highlighter-rouge">min-port</code> and <code class="language-plaintext highlighter-rouge">max-port</code> specify the port range for UDP relay end points, which are used locally by Jami and need not be opened in iptables.</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code># listening-port=3478
no-udp
no-tcp
tls-listening-port=&lt;turn-tls-port&gt;
min-port=63100
max-port=63200
fingerprint
lt-cred-mech
realm=&lt;realm-name&gt;
syslog
no-cli
</code></pre></div>    </div>

    <p>The log is written to <code class="language-plaintext highlighter-rouge">syslog</code>, which can be checked by <code class="language-plaintext highlighter-rouge">sudo journalctl -u coturn</code>.</p>
  </li>
  <li>
    <p>Add a TURN server user, which will be used by Jami clients.</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo turnadmin -a -u jihuan -p &lt;password&gt; -r quantumman
</code></pre></div>    </div>
  </li>
</ul>

<p>More information can be found here:</p>

<ul>
  <li><a href="https://docs.jami.net/developer/setting-up-your-own-turn-server.html">https://docs.jami.net/developer/setting-up-your-own-turn-server.html</a></li>
  <li><a href="https://matrix-org.github.io/synapse/latest/setup/turn/coturn.html">https://matrix-org.github.io/synapse/latest/setup/turn/coturn.html</a></li>
</ul>

<h1 id="port-mapping-in-wifi-routers">Port mapping in Wifi routers</h1>

<p>The port numbers exposed to the public in the Wifi routers should be mapped to the internal ports adopted by the OpenDHT and TURN servers.</p>

<h1 id="enable-iptables-rules">Enable iptables rules</h1>

<p>Edit <code class="language-plaintext highlighter-rouge">/etc/iptables.up.rules</code>:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Allow TURN server connections
-A INPUT -p tcp -m state --state NEW --dport &lt;turn-tls-port&gt; -j ACCEPT
-A INPUT -p udp -m state --state NEW --dport &lt;turn-tls-port&gt; -j ACCEPT

# Allow OpenDHT node connections
-A INPUT -p udp -m state --state NEW --dport &lt;opendht-port&gt; -j ACCEPT
</code></pre></div></div>

<h1 id="communication-quality-verification">Communication quality verification</h1>

<p>I’ve verified that 1920x1080 video resolution at 30 fps and screen sharing at 120 fps are well supported.</p>


  </div><a class="u-url" href="/computer/2023/06/11/encrypted-communication-via-jami.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2024 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
