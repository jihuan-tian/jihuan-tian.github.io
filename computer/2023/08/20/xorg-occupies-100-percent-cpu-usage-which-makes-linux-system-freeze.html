<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Xorg occupies 100% CPU usage which makes Linux system freeze | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Xorg occupies 100% CPU usage which makes Linux system freeze" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This phenomenon appears randomly and seems more frequent when the system is idle. For example, if I wait and let the monitor in power saving mode, or if I simply lock the screen for a while, when I come back again, the system is more probable to freeze." />
<meta property="og:description" content="This phenomenon appears randomly and seems more frequent when the system is idle. For example, if I wait and let the monitor in power saving mode, or if I simply lock the screen for a while, when I come back again, the system is more probable to freeze." />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2023/08/20/xorg-occupies-100-percent-cpu-usage-which-makes-linux-system-freeze.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2023/08/20/xorg-occupies-100-percent-cpu-usage-which-makes-linux-system-freeze.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-20T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Xorg occupies 100% CPU usage which makes Linux system freeze" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2023-08-20T00:00:00+08:00","datePublished":"2023-08-20T00:00:00+08:00","description":"This phenomenon appears randomly and seems more frequent when the system is idle. For example, if I wait and let the monitor in power saving mode, or if I simply lock the screen for a while, when I come back again, the system is more probable to freeze.","headline":"Xorg occupies 100% CPU usage which makes Linux system freeze","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2023/08/20/xorg-occupies-100-percent-cpu-usage-which-makes-linux-system-freeze.html"},"url":"https://jihuan-tian.github.io/computer/2023/08/20/xorg-occupies-100-percent-cpu-usage-which-makes-linux-system-freeze.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/font.css">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Xorg occupies 100% CPU usage which makes Linux system freeze</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-08-20T00:00:00+08:00" itemprop="datePublished">Aug 20, 2023 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/NVIDIA">NVIDIA</a>
          
            <a href="/tags/bug">bug</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>This phenomenon appears randomly and seems more frequent when the system is idle. For example, if I wait and let the monitor in power saving mode, or if I simply lock the screen for a while, when I come back again, the system is more probable to freeze.</p>

<p>I checked the system log <code class="language-plaintext highlighter-rouge">/var/log/syslog</code> and found the message “GPU has fallen off the bus” with the error code <code class="language-plaintext highlighter-rouge">Xid=79</code>. This code implies power issues. However, my NVIDIA card only consumes less than 30W power and for most of the time, it works properly and the said problem only appear while system is idle. Therefore, I’m quite sure that my NVIDIA card and power supply unit have no power issues.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Aug 16 19:25:51 QuantumHome kernel: [85385.218434] NVRM: GPU at PCI:0000:01:00: GPU
-cf1e233c-f6d6-2924-c14e-5a7dd3f34016
Aug 16 19:25:51 QuantumHome kernel: [85385.218456] NVRM: Xid (PCI:0000:01:00): 79,
pid='&lt;unknown&gt;', name=&lt;unknown&gt;, GPU has fallen off the bus.
Aug 16 19:25:51 QuantumHome kernel: [85385.218460] NVRM: GPU 0000:01:00.0: GPU has
fallen off the bus.
Aug 16 19:25:51 QuantumHome kernel: [85385.218490] NVRM: GPU 0000:01:00.0: GPU seri
al number is &lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;
&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;
&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;
&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;
&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;&lt;FF&gt;.
Aug 16 19:25:51 QuantumHome kernel: [85385.218505] NVRM: A GPU crash dump has been
created. If possible, please run
Aug 16 19:25:51 QuantumHome kernel: [85385.218505] NVRM: nvidia-bug-report.sh as ro
ot to collect this data before
Aug 16 19:25:51 QuantumHome kernel: [85385.218505] NVRM: the NVIDIA kernel module is unloaded.
Aug 16 19:26:30 QuantumHome kernel: [85423.585708] nvidia-modeset: ERROR: GPU:0: Failed to query display engine channel state: 0x0000c67e:0:0:0x0000000f
</code></pre></div></div>

<p>I executed <code class="language-plaintext highlighter-rouge">sudo nvidia-bug-report.sh</code>. In the generated report, I could see several DKMS builds of NVIDIA kernel module after recent Linux kernel upgrades:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*** /var/lib/dkms/nvidia/515.65.01/5.10.0-21-amd64/x86_64/log/make.log
*** ls: -rw-r--r-- 1 root root 28813 2023-01-24 20:28:41.040959053 +0800 /var/lib/d
kms/nvidia/515.65.01/5.10.0-21-amd64/x86_64/log/make.log
DKMS make.log for nvidia-515.65.01 for kernel 5.10.0-21-amd64 (x86_64)

*** /var/lib/dkms/nvidia/515.65.01/5.10.0-23-amd64/x86_64/log/make.log
*** ls: -rw-r--r-- 1 root root 28813 2023-05-14 06:17:10.852339523 +0800 /var/lib/dkms/nvidia/515.65.01/5.10.0-23-amd64/x86_64/log/make.log
DKMS make.log for nvidia-515.65.01 for kernel 5.10.0-23-amd64 (x86_64)

*** /var/lib/dkms/nvidia/515.65.01/5.10.0-24-amd64/x86_64/log/make.log
*** ls: -rw-r--r-- 1 root root 28813 2023-08-12 06:49:38.949305502 +0800 /var/lib/dkms/nvidia/515.65.01/5.10.0-24-amd64/x86_64/log/make.log
DKMS make.log for nvidia-515.65.01 for kernel 5.10.0-24-amd64 (x86_64)
</code></pre></div></div>

<p>Then I booted the system into the older kernels 5.10.0-21 and 5.10.0-23, both of them performed even worse: as long as I locked the screen, the system would immediately freeze. However, in the first half of this year, I did not meet such system freeze problem. Meanwhile, the NVIDIA driver 515.65.01 have been installed since last December without any update. Therefore, I guess the cause of the problem may not be the Linux kernel or NVIDIA driver.</p>

<p>Focusing on the power factor, the culprit may be some PCI power management strategy. According to <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/power_management_guide/aspm">here</a>, it is probably due to ASPM:</p>

<blockquote>
  <p>Active-State Power Management (ASPM) saves power in the Peripheral Component Interconnect Express (PCI Express or PCIe) subsystem by setting a lower power state for PCIe links when the devices to which they connect are not in use. ASPM controls the power state at both ends of the link, and saves power in the link even when the device at the end of the link is in a fully powered-on state.</p>
</blockquote>

<p>So I executed <code class="language-plaintext highlighter-rouge">sudo vi /etc/default/grub</code> and appended <code class="language-plaintext highlighter-rouge">pcie_aspm=off</code> to <code class="language-plaintext highlighter-rouge">GRUB_CMDLINE_LINUX_DEFAULT</code>. Then I ran <code class="language-plaintext highlighter-rouge">sudo update-grub</code> and rebooted the system. Now the system have run for a whole day smoothly. Hope such boot option modification will solve the problem.</p>

<p>Other tried solutions which now I think may not be related:</p>

<ol>
  <li>Run <code class="language-plaintext highlighter-rouge">nvidia-settings</code>, set the PowerMizer preferred mode as “maximum”.</li>
  <li>Turn off the <code class="language-plaintext highlighter-rouge">nvidia-suspend</code> service.</li>
</ol>


  </div><a class="u-url" href="/computer/2023/08/20/xorg-occupies-100-percent-cpu-usage-which-makes-linux-system-freeze.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2025 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
