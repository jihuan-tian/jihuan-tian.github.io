<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Compile ffmpeg with CUDA | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Compile ffmpeg with CUDA" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="It is very helpful for us to compile our own ffmpeg, if we own a NVIDIA graphics card. Then those routine tasks such as screen recording using VokoscreenNG, video conference using Wemeet, movie editing using Kdenlive, animation export from Paraview, etc. can all be accelerated and relieve the burden on CPU." />
<meta property="og:description" content="It is very helpful for us to compile our own ffmpeg, if we own a NVIDIA graphics card. Then those routine tasks such as screen recording using VokoscreenNG, video conference using Wemeet, movie editing using Kdenlive, animation export from Paraview, etc. can all be accelerated and relieve the burden on CPU." />
<link rel="canonical" href="https://jihuan-tian.github.io/computer/2023/09/08/compile-ffmpeg-with-cuda.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/computer/2023/09/08/compile-ffmpeg-with-cuda.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-09-08T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Compile ffmpeg with CUDA" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2023-09-08T00:00:00+08:00","datePublished":"2023-09-08T00:00:00+08:00","description":"It is very helpful for us to compile our own ffmpeg, if we own a NVIDIA graphics card. Then those routine tasks such as screen recording using VokoscreenNG, video conference using Wemeet, movie editing using Kdenlive, animation export from Paraview, etc. can all be accelerated and relieve the burden on CPU.","headline":"Compile ffmpeg with CUDA","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/computer/2023/09/08/compile-ffmpeg-with-cuda.html"},"url":"https://jihuan-tian.github.io/computer/2023/09/08/compile-ffmpeg-with-cuda.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/font.css">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet">
  <script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=67ba859acde8790019eafb38&product=inline-share-buttons' async='async'></script><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Compile ffmpeg with CUDA</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-09-08T00:00:00+08:00" itemprop="datePublished">Sep 8, 2023 &nbsp;

        
          Categories:
          
            <a href="/computer">Computer</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/CUDA">CUDA</a>
          
            <a href="/tags/ffmpeg">ffmpeg</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>It is very helpful for us to compile our own ffmpeg, if we own a NVIDIA graphics card. Then those routine tasks such as screen recording using VokoscreenNG, video conference using Wemeet, movie editing using Kdenlive, animation export from Paraview, etc. can all be accelerated and relieve the burden on CPU.</p>

<p>My graphics card is NVIDIA RTX A2000. I’ve installed the NVIDIA driver version 515.65.01 and CUDA version 11.7, which can be checked by calling the command <code class="language-plaintext highlighter-rouge">nvidia-smi</code>. With this information, I went to <a href="https://git.videolan.org/?p=ffmpeg.git;a=summary">ffmpeg Git repository</a>, checked the commit messages, from which I knew <a href="https://git.videolan.org/?p=ffmpeg.git;a=commit;h=ac0408522aa68444be28e4e691bfa61ab963c617">this commit</a> supports CUDA SDK 11.1. So I checked out this version of <code class="language-plaintext highlighter-rouge">ffmpeg</code>. Next, I visited <a href="https://git.videolan.org/?p=ffmpeg/nv-codec-headers.git;a=summary">nv-codec-headers git repository</a> and found the right version for me <a href="https://git.videolan.org/?p=ffmpeg/nv-codec-headers.git;a=commit;h=b641a195edbe3ac9788e681e22c2e2fad8aacddb">here</a>.</p>

<p>Before the compiling <code class="language-plaintext highlighter-rouge">ffmpeg</code>, I installed the following development packages on my Debian Bullseye:</p>

<ul>
  <li>libchromaprint-dev</li>
  <li>frei0-plugins-dev</li>
  <li>flite1-dev</li>
  <li>libgme-dev</li>
  <li>libgsm1-dev</li>
  <li>libjack-dev</li>
  <li>libjack0</li>
  <li>libmysofa-dev</li>
  <li>librabbitmq-dev</li>
  <li>librsvg2-dev</li>
  <li>librubberband-dev</li>
  <li>libshine-dev</li>
  <li>libsnappy-dev</li>
  <li>libspeex-dev</li>
  <li>libomxil-bellagio-dev</li>
  <li>libssh-dev</li>
  <li>libtwolame-dev</li>
  <li>libvidstab-dev</li>
  <li>libxvidcore-dev</li>
  <li>libzmq3-dev</li>
  <li>libzvbi-dev</li>
  <li>lv2-dev</li>
  <li>libpocketsphinx-dev</li>
  <li>libmfx-dev</li>
  <li>libdc1394-dev</li>
  <li>libdrm-dev</li>
  <li>libiec61883-dev: N.B. after installing it, the configure script of <code class="language-plaintext highlighter-rouge">ffmpeg</code> still cannot find it.</li>
</ul>

<p>Then I ran the old <code class="language-plaintext highlighter-rouge">ffmpeg</code> installed from Debian package, which displayed its configure options. Using these as template, I added CUDA related options, such as <code class="language-plaintext highlighter-rouge">--enable-cuds-nvcc</code>, <code class="language-plaintext highlighter-rouge">--enable-libnpp</code>. The complete configure options are given below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure <span class="nt">--libdir</span><span class="o">=</span>/usr/lib/x86_64-linux-gnu <span class="nt">--incdir</span><span class="o">=</span>/usr/include/x86_64-linux-gnu <span class="nt">--arch</span><span class="o">=</span>amd64 <span class="nt">--enable-cuda-nvcc</span> <span class="nt">--enable-libnpp</span> <span class="nt">--extra-cflags</span><span class="o">=</span><span class="nt">-I</span>/usr/local/cuda/include <span class="nt">--extra-ldflags</span><span class="o">=</span><span class="nt">-L</span>/usr/local/cuda/lib64 <span class="nt">--enable-libfdk-aac</span> <span class="nt">--enable-nonfree</span> <span class="nt">--enable-gpl</span> <span class="nt">--disable-stripping</span> <span class="nt">--enable-gnutls</span> <span class="nt">--enable-ladspa</span> <span class="nt">--enable-libaom</span> <span class="nt">--enable-libass</span> <span class="nt">--enable-libbluray</span> <span class="nt">--enable-libbs2b</span> <span class="nt">--enable-libcaca</span> <span class="nt">--enable-libcdio</span> <span class="nt">--enable-libcodec2</span> <span class="nt">--enable-libdav1d</span> <span class="nt">--enable-libflite</span> <span class="nt">--enable-libfontconfig</span> <span class="nt">--enable-libfreetype</span> <span class="nt">--enable-libfribidi</span> <span class="nt">--enable-libgme</span> <span class="nt">--enable-libgsm</span> <span class="nt">--enable-libjack</span> <span class="nt">--enable-libmp3lame</span> <span class="nt">--enable-libmysofa</span> <span class="nt">--enable-libopenjpeg</span> <span class="nt">--enable-libopenmpt</span> <span class="nt">--enable-libopus</span> <span class="nt">--enable-libpulse</span> <span class="nt">--enable-librabbitmq</span> <span class="nt">--enable-librsvg</span> <span class="nt">--enable-librubberband</span> <span class="nt">--enable-libshine</span> <span class="nt">--enable-libsnappy</span> <span class="nt">--enable-libsoxr</span> <span class="nt">--enable-libspeex</span> <span class="nt">--enable-libsrt</span> <span class="nt">--enable-libssh</span> <span class="nt">--enable-libtheora</span> <span class="nt">--enable-libtwolame</span> <span class="nt">--enable-libvidstab</span> <span class="nt">--enable-libvorbis</span> <span class="nt">--enable-libvpx</span> <span class="nt">--enable-libwebp</span> <span class="nt">--enable-libx265</span> <span class="nt">--enable-libxml2</span> <span class="nt">--enable-libxvid</span> <span class="nt">--enable-libzmq</span> <span class="nt">--enable-libzvbi</span> <span class="nt">--enable-lv2</span> <span class="nt">--enable-omx</span> <span class="nt">--enable-openal</span> <span class="nt">--enable-opengl</span> <span class="nt">--enable-sdl2</span> <span class="nt">--enable-pocketsphinx</span> <span class="nt">--enable-libmfx</span> <span class="nt">--enable-libdc1394</span> <span class="nt">--enable-libdrm</span> <span class="nt">--enable-chromaprint</span> <span class="nt">--enable-frei0r</span> <span class="nt">--enable-libx264</span> <span class="nt">--enable-shared</span>
</code></pre></div></div>

<p>After compilation and installation, we can check available CUDA related codecs by running the command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/usr/local/bin/ffmpeg <span class="nt">-codecs</span> | <span class="nb">grep </span>cuvid
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DEV.L. av1                  Alliance for Open Media AV1 (decoders: libdav1d libaom-av1 av1 av1_cuvid av1_qsv ) (encoders: libaom-av1 )
DEV.LS h264                 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (decoders: h264 h264_v4l2m2m h264_qsv h264_cuvid ) (encoders: libx264 libx264rgb h264_nvenc h264_omx h264_qsv h264_v4l2m2m )
DEV.L. hevc                 H.265 / HEVC (High Efficiency Video Coding) (decoders: hevc hevc_qsv hevc_v4l2m2m hevc_cuvid ) (encoders: libx265 hevc_nvenc hevc_qsv hevc_v4l2m2m )
DEVIL. mjpeg                Motion JPEG (decoders: mjpeg mjpeg_cuvid mjpeg_qsv ) (encoders: mjpeg mjpeg_qsv )
DEV.L. mpeg1video           MPEG-1 video (decoders: mpeg1video mpeg1_v4l2m2m mpeg1_cuvid )
DEV.L. mpeg2video           MPEG-2 video (decoders: mpeg2video mpegvideo mpeg2_v4l2m2m mpeg2_qsv mpeg2_cuvid ) (encoders: mpeg2video mpeg2_qsv )
DEV.L. mpeg4                MPEG-4 part 2 (decoders: mpeg4 mpeg4_v4l2m2m mpeg4_cuvid ) (encoders: mpeg4 libxvid mpeg4_omx mpeg4_v4l2m2m )
D.V.L. vc1                  SMPTE VC-1 (decoders: vc1 vc1_qsv vc1_v4l2m2m vc1_cuvid )
DEV.L. vp8                  On2 VP8 (decoders: vp8 vp8_v4l2m2m libvpx vp8_cuvid vp8_qsv ) (encoders: libvpx vp8_v4l2m2m )
DEV.L. vp9                  Google VP9 (decoders: vp9 vp9_v4l2m2m libvpx-vp9 vp9_cuvid vp9_qsv ) (encoders: libvpx-vp9 vp9_qsv )
</code></pre></div></div>


  </div><div class="sharethis-inline-share-buttons"></div>

  <script src="https://utteranc.es/client.js"
          repo="jihuan-tian/jihuan-tian.github.io"
          issue-term="pathname"
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>

  <a class="u-url" href="/computer/2023/09/08/compile-ffmpeg-with-cuda.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2025 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
