<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>How to build an $\mathcal{H}$-matrix on a subdomain | 止于至善</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="How to build an $\mathcal{H}$-matrix on a subdomain" />
<meta name="author" content="Jihuan Tian" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In Galerkin BEM, an \(\mathcal{H}\)-matrix is built with respect to the test and trial spaces of a bilinear form. This bilinear form is related to a boundary integral operator. The test space of the bilinear form is the dual space of the boundary integral operator’s range space and the trial space is the operator’s domain space. In boundary integral equations (BIEs) derived from an elliptic partial differential equation (PDE) with mixed boundary conditions, there are bilinear forms in the BIEs whose test space and/or trial space are defined on an open subset of \(\Gamma\). In deal.II, a DoF (degree of freedom) handler, defined with respect to a finite element and a triangulation, holds all DoFs distributed on the triangulation. Therefore, to build an \(\mathcal{H}\)-matrix for a bilinear form with function spaces on a subdomain, only a subset of DoFs should be selected from the DoF handler, which can then be used to build a cluster tree, block cluster tree and \(\mathcal{H}\)-matrix." />
<meta property="og:description" content="In Galerkin BEM, an \(\mathcal{H}\)-matrix is built with respect to the test and trial spaces of a bilinear form. This bilinear form is related to a boundary integral operator. The test space of the bilinear form is the dual space of the boundary integral operator’s range space and the trial space is the operator’s domain space. In boundary integral equations (BIEs) derived from an elliptic partial differential equation (PDE) with mixed boundary conditions, there are bilinear forms in the BIEs whose test space and/or trial space are defined on an open subset of \(\Gamma\). In deal.II, a DoF (degree of freedom) handler, defined with respect to a finite element and a triangulation, holds all DoFs distributed on the triangulation. Therefore, to build an \(\mathcal{H}\)-matrix for a bilinear form with function spaces on a subdomain, only a subset of DoFs should be selected from the DoF handler, which can then be used to build a cluster tree, block cluster tree and \(\mathcal{H}\)-matrix." />
<link rel="canonical" href="https://jihuan-tian.github.io/math/2025/11/04/how-to-build-hmatrix-on-subdomain.html" />
<meta property="og:url" content="https://jihuan-tian.github.io/math/2025/11/04/how-to-build-hmatrix-on-subdomain.html" />
<meta property="og:site_name" content="止于至善" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-11-04T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="How to build an $\mathcal{H}$-matrix on a subdomain" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jihuan Tian"},"dateModified":"2025-11-04T00:00:00+08:00","datePublished":"2025-11-04T00:00:00+08:00","description":"In Galerkin BEM, an \\(\\mathcal{H}\\)-matrix is built with respect to the test and trial spaces of a bilinear form. This bilinear form is related to a boundary integral operator. The test space of the bilinear form is the dual space of the boundary integral operator’s range space and the trial space is the operator’s domain space. In boundary integral equations (BIEs) derived from an elliptic partial differential equation (PDE) with mixed boundary conditions, there are bilinear forms in the BIEs whose test space and/or trial space are defined on an open subset of \\(\\Gamma\\). In deal.II, a DoF (degree of freedom) handler, defined with respect to a finite element and a triangulation, holds all DoFs distributed on the triangulation. Therefore, to build an \\(\\mathcal{H}\\)-matrix for a bilinear form with function spaces on a subdomain, only a subset of DoFs should be selected from the DoF handler, which can then be used to build a cluster tree, block cluster tree and \\(\\mathcal{H}\\)-matrix.","headline":"How to build an $\\mathcal{H}$-matrix on a subdomain","mainEntityOfPage":{"@type":"WebPage","@id":"https://jihuan-tian.github.io/math/2025/11/04/how-to-build-hmatrix-on-subdomain.html"},"url":"https://jihuan-tian.github.io/math/2025/11/04/how-to-build-hmatrix-on-subdomain.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/font.css">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="stylesheet" href="/assets/css/htmlize-syntax-highlight.css">
  
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link href="https://fonts.googlefonts.cn/css?family=EB+Garamond" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://jihuan-tian.github.io/feed.xml" title="止于至善" />
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    jax: ["input/TeX", "output/SVG"],
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js", "TeX/noUndefined.js", "TeX/AMScd.js"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      skipTags: ["script","noscript","style","textarea","pre","code"],
      processEscapes: true,
      processEnvironments: true,
      preview: "TeX"
    },
    TeX: {
      Macros: {
        intd: "\\,{\\rm d}",
        diff: "{\\rm d}",
        Diff: "{\\rm D}",
        pdiff: "\\partial",
        DD: ["\\frac{\\diff}{\\diff #2}\\left( #1 \\right)", 2],
        Dd: ["\\frac{\\diff #1}{\\diff #2}", 2],
        PD: ["\\frac{\\pdiff}{\\pdiff #2}\\left( #1 \\right)", 2],
        Pd: ["\\frac{\\pdiff #1}{\\pdiff #2}", 2],
        rme: "{\\rm e}",
        rmi: "{\\rm i}",
        rmj: "{\\rm j}",
        vect: ["\\boldsymbol{#1}", 1],
        dform: ["\\overset{\\rightharpoonup}{\\boldsymbol{#1}}", 1],
        cochain: ["\\overset{\\rightharpoonup}{#1}", 1],
        bigabs: ["\\bigg\\lvert#1\\bigg\\rvert", 1],
        Abs: ["\\big\\lvert#1\\big\\rvert", 1],
        abs: ["\\lvert#1\\rvert", 1],
        bignorm: ["\\bigg\\lVert#1\\bigg\\rVert", 1],
        Norm: ["\\big\\lVert#1\\big\\rVert", 1],
        norm: ["\\lVert#1\\rVert", 1],
        normvect: "\\vect{n}",
        ouset: ["\\overset{#3}{\\underset{#2}{#1}}", 3],
        cscript: ["\\;\\; #1", 1],
        suchthat: "\\textit{S.T. }",
        prefstar: "\\ast",
        restrict: "\\big\\vert",
        sgn: "{\\rm sgn}",
        erf: "{\\rm erf}",
        Bd: "{\\rm Bd}",
        Int: "{\\rm Int}",
        dim: "{\\rm dim}",
        rank: "{\\rm rank}",
        range: "{\\rm range}",
        divergence: "{\\rm div}",
        curl: "{\\rm curl}",
        grad: "{\\rm grad}",
        tr: "{\\rm tr}",
        lhs: "{\\rm LHS}",
        rhs: "{\\rm RHS}",
        span: "{\\rm span}",
        diag: "{\\rm diag}",
        argmin: "{\\rm argmin}",
        argmax: "{\\rm argmax}",
        esssup: "{\\rm esssup}",
        essinf: "{\\rm essinf}",
        kernel: "{\\rm ker}",
        image: "{\\rm Im}",
        diam: "{\\rm diam}",
        dist: "{\\rm dist}",
        const: "{\\rm const}",
        real: "{\\rm Re}",
        imag: "{\\rm Imag}"
      },
      equationNumbers: { autoNumber: "AMS" }
    }
  });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_SVG"></script>

  
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">止于至善</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          <!-- Enforce a fixed order for my categories. -->
          <a class="page-link" href="/math/">Math</a>
          <a class="page-link" href="/computer/">Computer</a>
          <a class="page-link" href="/thoughts/">Thoughts</a>
          <a class="page-link" href="/tags/">Tags</a>
          <a class="page-link" href="/about/">About</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How to build an $\mathcal{H}$-matrix on a subdomain</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-11-04T00:00:00+08:00" itemprop="datePublished">
        Tue, Nov 4, W44, 2025 &nbsp;

        
          Categories:
          
            <a href="/math">Math</a>
          
         &nbsp;
        
          Tags:
          
            <a href="/tags/BEM">BEM</a>
          
        
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In Galerkin BEM, an \(\mathcal{H}\)-matrix is built with respect to the test and trial spaces of a bilinear form. This bilinear form is related to a boundary integral operator. The test space of the bilinear form is the dual space of the boundary integral operator’s range space and the trial space is the operator’s domain space. In boundary integral equations (BIEs) derived from an elliptic partial differential equation (PDE) with mixed boundary conditions, there are bilinear forms in the BIEs whose test space and/or trial space are defined on an open subset of \(\Gamma\). In deal.II, a DoF (degree of freedom) handler, defined with respect to a finite element and a triangulation, holds all DoFs distributed on the triangulation. Therefore, to build an \(\mathcal{H}\)-matrix for a bilinear form with function spaces <strong>on a subdomain</strong>, only a subset of DoFs should be selected from the DoF handler, which can then be used to build a cluster tree, block cluster tree and \(\mathcal{H}\)-matrix.</p>

<h1 id="elliptic-pde-and-its-boundary-integral-equations">Elliptic PDE and its boundary integral equations</h1>

<p>An elliptic PDE with mixed boundary conditions is given as</p>

\[\begin{equation}
  \begin{aligned}
    Lu &amp;= 0 \; (x\in \Omega), \\
    \gamma_0^{\rm int}u &amp;= g_{\mathrm{D}} \; (x\in\Gamma_{\mathrm{D}}), \\
    \gamma_1^{\rm int}u &amp;= g_{\mathrm{N}} \; (x\in\Gamma_{\mathrm{N}}),
  \end{aligned}
\end{equation}\]

<p>where \(L: X \rightarrow X'\) is a self-adjoint second order elliptic partial differential operator, \(X\) is a Hilbert space with an inner product \(\langle \cdot,\cdot \rangle_X\), \(X'\) is the dual space of \(X\), \(\Gamma\) is the boundary of \(\Omega\) and \(\Gamma=\overline{\Gamma}_{\mathrm{D}}\cup\overline{\Gamma}_{\mathrm{N}}\).</p>

<p>The general form of \(L\) is</p>

\[\begin{equation}
  \label{eq:diff-operator-2nd-order}
  (Lu)(x) := -\sum_{i,j=1}^d \frac{\pdiff}{\pdiff x_j} \left[ a_{ji}(x)\frac{\pdiff
      u}{\pdiff x_{i}} \right] + a_0(x)u(x),
\end{equation}\]

<p>where \(d\) is the spatial dimension and \(a_{ji}(x)=a_{ij}(x)\).</p>

<p>\(u\in H^1(\Omega)\) is the potential distribution in \(\Omega\). \(\gamma_0^{\mathrm{int}} u\) is its interior Dirichlet trace:</p>

\[\begin{equation}
  \label{eq:interior-dirichlet-trace}
  (\gamma_0^{\mathrm{int}}u)(x) := \lim_{\Omega\ni\tilde{x} \rightarrow x\in\Gamma} u(\tilde{x}).
\end{equation}\]

<p>\(\gamma_1^{\mathrm{int}} u\) is the interior co-normal trace or Neumann trace:</p>

\[\begin{equation}
  \label{eq:interior-conormal-trace}
  \gamma_1^{\rm int}u(x):=\lim_{\Omega\ni \tilde{x} \rightarrow x \in\Gamma} \left[
    \sum_{i,j=1}^d n_j(x)a_{ji}(\tilde{x})\frac{\pdiff u(\tilde{x})}{\pdiff \tilde{x}_i} \right],
\end{equation}\]

<p>where \(n_j(x)\) is the \(j\)-th coordinate of the <strong>outward</strong> unit normal vector \(\boldsymbol{n}\) at \(x\) on \(\Gamma\). The given Dirichlet boundary condition is \(g_{\mathrm{D}}\in H^{1/2}(\Gamma_{\mathrm{D}})\) and the Neumann boundary condition is \(g_{\mathrm{N}}\in H^{-1/2}(\Gamma_{\mathrm{N}})\).</p>

<p>Testing the PDE \(Lu=0\) with an arbitrary \(v\in X\) and apply integration by parts, we obtain the Green’s first identity</p>

\[\begin{equation}
  \label{eq:green-1st-identity-general}
  a(u,v) = \int_{\Omega} (Lu)(x)v(x) \intd x + \int_{\Gamma} \gamma_1^{\rm int}u(x)
  \gamma_0^{\rm int}v(x) \intd s,
\end{equation}\]

<p>where \(a(u,v)\) is a bilinear form</p>

\[\begin{equation}
  \label{eq:bilinear-form-2nd-order-pde}
  a(u,v):=\sum_{i,j=1}^d\int_{\Omega}a_{ji}(x)\frac{\pdiff u}{\pdiff x_{i}}\frac{\pdiff
    v}{\pdiff x_{j}}\intd x + \int_{\Omega}a_0uv \intd x.
\end{equation}\]

<p>Because \(L\) is self-adjoint, the bilinear form is symmetric, i.e. \(a(u,v)=a(v,u)\) and we can obtain the second Green’s identity</p>

\[\begin{equation}
  \label{eq:green-2nd-identity-general}
  \int_{\Omega} (Lu)(x)v(x) \intd x - \int_{\Omega}(Lv)(x)u(x) \intd x =
  \int_{\Gamma}\gamma_1^{\rm int}v(x)\gamma_0^{\rm int}u(x) \intd s -
  \int_{\Gamma} \gamma_1^{\rm int}u(x)\gamma_0^{\rm int}v(x) \intd s.
\end{equation}\]

<p>By replacing the test function \(v\) with the fundamental solution \(U^{\ast}(x,y)\) of \(L\), a representation formula of the potential \(u\) as the solution of the homogeneous PDE \(Lu=0\) is derived</p>

\[\begin{equation}
  \label{eq:representation-formula}
  u(x) = \int_{\Gamma} U^{\ast}(x,y) \gamma_{1,y}^{\mathrm{int}} u(y) \intd s_y -
  \int_{\Gamma} \gamma_{1,y}^{\mathrm{int}} U^{\ast}(x,y) \gamma_0^{\mathrm{int}}
  u(y) \intd s_y \quad x\in\Omega.
\end{equation}\]

<p>Let the field point \(x\) approach the boundary \(\Gamma\) and taking the interior Dirichlet trace and Neumann trace of the representation formula, we obtain two BIEs, which form the Calderón system</p>

\[\begin{equation}
  \label{eq:calderon-system}
  \begin{pmatrix}
    \gamma_0^{\rm int} u \\ \gamma_1^{\rm int} u
  \end{pmatrix}
  = \begin{pmatrix}
    (1-\sigma)I - K &amp; V \\
    D &amp; \sigma I + K'
  \end{pmatrix}
  \begin{pmatrix}
    \gamma_0^{\rm int} u \\ \gamma_1^{\rm int} u
  \end{pmatrix},
\end{equation}\]

<p>where</p>

\[\begin{equation}
  C = \begin{pmatrix}
    (1-\sigma)I - K &amp; V \\
    D &amp; \sigma I + K'
  \end{pmatrix}
\end{equation}\]

<p>is called the Calderón projection operator. This operator describes how to represent either Dirichlet or Neumann data on the boundary \(\Gamma\) using the complete Cauchy data \(\left\{ \gamma_0^{\mathrm{int}}u,\gamma_1^{\mathrm{int}}u \right\}\). Organizing terms in the Calderón system, then restricting \(x\) in the first equation within \(\Gamma_{\mathrm{D}}\) and \(x\) in the second equation within \(\Gamma_{\mathrm{N}}\), we obtain two BIEs for the elliptic PDE with mixed boundary conditions</p>

\[\begin{equation}
  \begin{aligned}
    (V \gamma_1^{\mathrm{int}}u)(x) &amp;= \left[ (\sigma I + K) \gamma_0^{\mathrm{int}}u
    \right](x) \quad x\in\Gamma_{\mathrm{D}}, \\
    (D \gamma_0^{\mathrm{int}}u)(x) &amp;= \left\{ \left[ (1-\sigma)I - K' \right]
      \gamma_1^{\mathrm{int}}u \right\}(x) \quad x\in\Gamma_{\mathrm{N}}.
  \end{aligned}
  \label{eq:bies}
\end{equation}\]

<h1 id="extension-of-boundary-conditions-and-split-of-boundary-traces">Extension of boundary conditions and split of boundary traces</h1>

<p>The original boundary conditions \(g_{\mathrm{D}}\) and \(g_{\mathrm{N}}\) are defined on subdomains \(\Gamma_{\mathrm{D}}\) and \(\Gamma_{\mathrm{N}}\) respectively. We now extend them to the whole boundary as \(\tilde{g}_{\mathrm{D}}\) and \(\tilde{g}_{\mathrm{N}}\) such that</p>

\[\begin{equation}
  \begin{aligned}
    \tilde{g}_{\mathrm{D}}\in H^{1/2}(\Gamma), \tilde{g}_{\mathrm{D}}(x) &amp;=
    g_{\mathrm{D}}(x) \quad (x\in\Gamma_{\mathrm{D}}), \\
    \tilde{g}_{\mathrm{N}}\in H^{-1/2}(\Gamma), \tilde{g}_{\mathrm{N}}(x) &amp;=
    g_{\mathrm{N}}(x) \quad (x\in\Gamma_{\mathrm{N}}).
  \end{aligned}
\end{equation}\]

<p>Then the Dirichlet trace \(\gamma_0^{\mathrm{int}}u\) and Neumann trace \(\gamma_1^{\mathrm{int}}u\) on \(\Gamma\) can be decomposed as</p>

\[\begin{equation}
  \gamma_0^{\mathrm{int}}u = \tilde{u} + \tilde{g}_{\mathrm{D}}, \gamma_1^{\mathrm{int}}u = \tilde{t} + \tilde{g}_{\mathrm{N}},
\end{equation}\]

<p>where \(\tilde{u}\big\vert_{\Gamma_{\mathrm{D}}} = 0\) and \(\tilde{t}\big\vert_{\Gamma_{\mathrm{N}}} = 0\). This means the support of \(\tilde{u}\) is contained in \(\Gamma_{\mathrm{N}}\) and the support of \(\tilde{t}\) is contained in \(\Gamma_{\mathrm{D}}\), hence \(\tilde{u}\in \tilde{H}^{1/2}(\Gamma_{\mathrm{N}})\) and \(\tilde{t}\in\tilde{H}^{-1/2}(\Gamma_{\mathrm{D}})\). Substitute the above decomposition of \(\gamma_0^{\mathrm{int}}u\) and \(\gamma_1^{\mathrm{int}}u\) into the BIEs in Equation \eqref{eq:bies}, we have</p>

\[\begin{equation}
  \begin{aligned}
    V (\tilde{t}+\tilde{g}_{\mathrm{N}})(x) &amp;= (\sigma I + K)
      (\tilde{u}+\tilde{g}_{\mathrm{D}}) (x) \quad x\in\Gamma_{\mathrm{D}}, \\
    D (\tilde{u}+\tilde{g}_{\mathrm{D}})(x) &amp;= \left[ (1-\sigma)I - K' \right]
      (\tilde{t}+\tilde{g}_{\mathrm{N}}) (x) \quad x\in\Gamma_{\mathrm{N}}.
  \end{aligned}
\end{equation}\]

<p>In the first equation, \((\sigma I \tilde{u})(x)=0\) for \(x\in\Gamma_{\mathrm{D}}\), because the term \(\sigma I\) only appears if the field point \(\tilde{x}\) in the double layer potential \((K\tilde{u})(\tilde{x}) = \int_{\Gamma} \gamma_{1,y}^{\mathrm{int}}U^{\ast}(x,y)\tilde{u}(y) \intd s_y\) can approach to a source point \(y\) on \(\Gamma\), when we take the limit \(\tilde{x}\in\Omega \rightarrow x\in\Gamma\). \(\tilde{u}\in\tilde{H}^{1/2}(\Gamma_{\mathrm{N}})\) only has nonzero part in \(\Gamma_{\mathrm{N}}\), so the effective integration domain in \(K\tilde{u}\) is \(\Gamma_{\mathrm{N}}\) and the field point \(x\) is outside \(\Gamma_{\mathrm{N}}\). Similarly, in the second equation, \(\left[ (1-\sigma)I\tilde{t} \right](x) = 0\) for \(x\in\Gamma_{\mathrm{N}}\).</p>

<p>After organizing unknown terms to the left and given boundary conditions to the right, the BIEs become</p>

\[\begin{equation}
  \begin{aligned}
    V \tilde{t}(x) - K\tilde{u}(x) &amp;= (\sigma I + K)\tilde{g}_{\mathrm{D}}(x) - V
    \tilde{g}_{\mathrm{N}}(x) \quad x\in\Gamma_{\mathrm{D}}, \\
    K'\tilde{t}(x) + D\tilde{u}(x) &amp;= -D\tilde{g}_{\mathrm{D}}(x) + \left[ (1-\sigma)I-K'
    \right]\tilde{g}_{\mathrm{N}}(x) \quad x\in\Gamma_{\mathrm{N}}.
  \end{aligned}
\end{equation}\]

<p>They can be written in a matrix form as below</p>

\[\begin{equation}
  \label{eq:bies-in-matrix-form}
  \begin{pmatrix}
    V &amp; -K \\
    K' &amp; D
  \end{pmatrix}
  \begin{pmatrix}
    \tilde{t} \\ \tilde{u}
  \end{pmatrix}
  = \begin{pmatrix}
    \sigma I + K &amp; -V \\
    -D &amp; (1-\sigma) I - K'
  \end{pmatrix}
  \begin{pmatrix}
    \tilde{g}_{\mathrm{D}} \\ \tilde{g}_{\mathrm{N}}
  \end{pmatrix}.
\end{equation}\]

<h1 id="variational-formulation-of-the-bies">Variational formulation of the BIEs</h1>

<p>Test the first BIE in Equation \eqref{eq:bies-in-matrix-form} with \(v\in\tilde{H}^{-1/2}(\Gamma_{\mathrm{D}})\) and the second BIE with \(q\in\tilde{H}^{1/2}(\Gamma_{\mathrm{N}})\), we obtain the variational formulation</p>

\[\begin{equation}
  \begin{aligned}
    b_V(\tilde{t},v) - b_K(\tilde{u},v) &amp;= b_{\sigma I+K}(\tilde{g}_{\mathrm{D}},v) -
    b_V(\tilde{g}_{\mathrm{N}},v), \\
    b_{K'}(\tilde{t},q) + b_D(\tilde{u},q) &amp;= -b_D(\tilde{g}_{\mathrm{D}},q) +
    b_{(1-\sigma)I-K'}(\tilde{g}_{\mathrm{N}},q).
  \end{aligned}
  \label{eq:variational-form}
\end{equation}\]

<p>We can see that all the boundary integral operators \(V\), \(K\), \(K'\) and \(D\) as well as their bilinear forms appear two times in the BIEs and the two versions of each operator have different domain spaces. The identity operator \(I\) along with its bilinear form also appears two times and they have both different domain spaces and range spaces. Because bilinear forms on different spaces lead to different matrices, we explicitly use subscripts to differentiate them in the BIEs:</p>

\[\begin{equation}
  \begin{aligned}
    b_{V_1}(\tilde{t},v) - b_{K_1}(\tilde{u},v) &amp;= b_{\sigma I_1+K_2}(\tilde{g}_{\mathrm{D}},v) -
    b_{V_2}(\tilde{g}_{\mathrm{N}},v), \\
    b_{K_1'}(\tilde{t},q) + b_{D_1}(\tilde{u},q) &amp;= -b_{D_2}(\tilde{g}_{\mathrm{D}},q) +
    b_{(1-\sigma)I_2-K_2'}(\tilde{g}_{\mathrm{N}},q).
  \end{aligned}
  \label{eq:variational-form-with-subscripts}
\end{equation}\]

<p>The spaces associated with these operators and bilinear forms are listed below.</p>

\[\begin{equation}
  \begin{aligned}
    V_1 &amp;: \tilde{H}^{-1/2}(\Gamma_{\mathrm{D}}) \rightarrow H^{1/2}(\Gamma_{\mathrm{D}})
    \quad b_{V_1}: \tilde{H}^{-1/2}(\Gamma_{\mathrm{D}}) \times
    \tilde{H}^{-1/2}(\Gamma_{\mathrm{D}}) \rightarrow \mathbb{R} \\
    K_1 &amp;: \tilde{H}^{1/2}(\Gamma_{\mathrm{N}}) \rightarrow H^{1/2}(\Gamma_{\mathrm{D}})
    \quad b_{K_1}: \tilde{H}^{1/2}(\Gamma_{\mathrm{N}}) \times
    \tilde{H}^{-1/2}(\Gamma_{\mathrm{D}}) \rightarrow \mathbb{R} \\
    K_1' &amp;: \tilde{H}^{-1/2}(\Gamma_{\mathrm{D}}) \rightarrow
    H^{-1/2}(\Gamma_{\mathrm{N}}) \quad b_{K_1'}: \tilde{H}^{-1/2}(\Gamma_{\mathrm{D}})
    \times \tilde{H}^{1/2}(\Gamma_{\mathrm{N}}) \rightarrow \mathbb{R} \\
    D_1 &amp;: \tilde{H}^{1/2}(\Gamma_{\mathrm{N}}) \rightarrow H^{-1/2}(\Gamma_{\mathrm{N}})
    \quad b_{D_1}: \tilde{H}^{1/2}(\Gamma_{\mathrm{N}}) \times
    \tilde{H}^{1/2}(\Gamma_{\mathrm{N}}) \rightarrow \mathbb{R} \\
    I_1 &amp;: H^{1/2}(\Gamma) \rightarrow H^{1/2}(\Gamma_{\mathrm{D}}) \quad b_{I_1}:
    H^{1/2}(\Gamma) \times \tilde{H}^{-1/2}(\Gamma_{\mathrm{D}}) \rightarrow \mathbb{R} \\
    K_2 &amp;: H^{1/2}(\Gamma) \rightarrow H^{1/2}(\Gamma_{\mathrm{D}}) \quad b_{K_2}:
    H^{1/2}(\Gamma) \times \tilde{H}^{-1/2}(\Gamma_{\mathrm{D}}) \rightarrow \mathbb{R} \\
    V_2 &amp;: H^{-1/2}(\Gamma) \rightarrow H^{1/2}(\Gamma_{\mathrm{D}}) \quad b_{V_2}:
    H^{-1/2}(\Gamma) \times \tilde{H}^{-1/2}(\Gamma_{\mathrm{D}}) \rightarrow \mathbb{R}
    \\
    D_2 &amp;: H^{1/2}(\Gamma) \rightarrow H^{-1/2}(\Gamma_{\mathrm{N}}) \quad b_{D_2}:
    H^{1/2}(\Gamma) \times \tilde{H}^{1/2}(\Gamma_{\mathrm{N}}) \rightarrow \mathbb{R} \\
    I_2 &amp;: H^{-1/2}(\Gamma) \rightarrow H^{-1/2}(\Gamma_{\mathrm{N}}) \quad b_{I_2}:
    H^{-1/2}(\Gamma) \times \tilde{H}^{1/2}(\Gamma_{\mathrm{N}}) \rightarrow \mathbb{R} \\
    K_2' &amp;: H^{-1/2}(\Gamma) \rightarrow H^{-1/2}(\Gamma_{\mathrm{N}}) \quad b_{K_2'}:
    H^{-1/2}(\Gamma) \times \tilde{H}^{1/2}(\Gamma_{\mathrm{N}}) \rightarrow \mathbb{R} \\
  \end{aligned}
\end{equation}\]

<h1 id="discretization-of-bilinear-forms-into-galerkin-matrices">Discretization of bilinear forms into Galerkin matrices</h1>

<p>We use the first order piecewise linear finite element to approximate the Sobolev space \(H^{1/2}(\Gamma)\) and write it as \(H_h^{1/2}(\Gamma)\). In deal.II, this finite element is an object <code class="language-plaintext highlighter-rouge">FE_Q(1)</code>. We then use the piecewise constant finite element to approximate the space \(H^{-1/2}(\Gamma)\) and write it as \(H_h^{-1/2}(\Gamma)\). The corresponding deal.II object is <code class="language-plaintext highlighter-rouge">FE_DGQ(0)</code>. Two DoF handlers are needed, one for \(H_h^{1/2}(\Gamma)\), we call it the DoF handler for the Dirichlet data; one for \(H_h^{-1/2}(\Gamma)\), we call it the DoF handler for the Neumann data.</p>

<p>A DoF handler object is created from a finite element and a triangulation. The triangulation is generated for the whole boundary \(\Gamma\). Therefore, the DoF handler holds all DoFs distributed on the triangulation. When the function space \(H^{1/2}(\Gamma)\) or \(H^{-1/2}(\Gamma)\) is restricted to an open subset of \(\Gamma\), such as \(\Gamma_{\mathrm{D}}\) or \(\Gamma_{\mathrm{N}}\), we need to select only part of the DoFs in the DoF handler, which are used to build a cluster tree, block cluster and \(\mathcal{H}\)-matrix. Next, we will show how to select DoFs for restricted function spaces used by bilinear forms.</p>

<ul>
  <li>
    <p>For the finite dimensional space \(\tilde{H}_h^{-1/2}(\Gamma_{\mathrm{D}})\) of the unknown Neumann data, we select DoFs in the DoF handler for the Neumann data by iterating over cells with material IDs belonging to the boundary \(\Gamma_{\mathrm{D}}\). During the iteration in cells within \(\Gamma_{\mathrm{D}}\), the DoF-to-cell topology for the selected DoFs is also built.</p>

    <p>The following figure shows the selected DoFs for \(\tilde{H}_h^{-1/2}(\Gamma_{\mathrm{D}})\), the unselected DoFs in \(H_h^{-1/2}(\Gamma)\), and the support of the DoFs in \(\tilde{H}_h^{-1/2}(\Gamma_{\mathrm{D}})\).</p>

    <p><img src="/figures/2025-11-03-select-dofs-for-sobolev-spaces-on-subdomain_unknown-neumann.png" alt="img" title="Select DoFs for the finite dimensional space $$\tilde{H}_h^{-1/2}(\Gamma_{\mathrm{D}}) $$ of the unknown Neumann data." /></p>
  </li>
  <li>
    <p>The finite dimensional space \(\tilde{H}_h^{1/2}(\Gamma_{\mathrm{N}})\) of the unknown Dirichlet data is a continuous function space and a function in this space vanishes outside \(\Gamma_{\mathrm{N}}\). Therefore, the DoFs in \(\overline{\Gamma}_{\mathrm{D}}\), i.e. including the interface between \(\Gamma_{\mathrm{D}}\) and \(\Gamma_{\mathrm{N}}\), should be deselected from \(H_h^{1/2}(\Gamma)\). This can be implemented by iterating over cells with material IDs <strong>not</strong> belonging to \(\Gamma_{\mathrm{N}}\) and deselecting their associated DoFs.</p>

    <p>The DoF-to-cell topology for the selected DoFs can be built by iterating over cells in \(\Gamma_{\mathrm{N}}\).</p>

    <p><img src="/figures/2025-11-03-select-dofs-for-sobolev-spaces-on-subdomain_unknown-dirichlet.png" alt="img" title="Select DoFs for the finite dimensional space $$\tilde{H}_h^{1/2}(\Gamma_{\mathrm{N}}) $$ of the unknown Dirichlet data." /></p>
  </li>
  <li>
    <p>The extended Dirichlet boundary condition \(\tilde{g}_{\mathrm{D}}\) belongs to the space \(H^{1/2}(\Gamma)\). The extension of \(g_{\mathrm{D}}\) from \(H^{1/2}(\Gamma_{\mathrm{D}})\) to \(H^{1/2}(\Gamma)\) is not unique but should be conforming with \(H^{1/2}(\Gamma)\); in particular, the continuity of \(\tilde{g}_{\mathrm{D}}\) should be preserved. We can construct \(\tilde{g}_{\mathrm{D}}\) by extending \(g_{\mathrm{D}}\) with zeros: all DoFs in \(\Gamma_{\mathrm{D}}\) are selected from the DoF handler for the Dirichlet data, i.e. from the space \(H_h^{1/2}(\Gamma)\), and the support of these DoFs at the interface \(\overline{\Gamma}_{\mathrm{D}} \cap \overline{\Gamma}_{\mathrm{N}}\) naturally decays to zero. Consequently, the support of the selected DoFs <strong>penetrates</strong> one layer of cells into \(\Gamma_{\mathrm{N}}\). The resulting discrete space is denoted by \(\tilde{H}_h^{1/2}(\Gamma_{\mathrm{D}}^{\ast})\).</p>

    <p>Because of support penetration, the DoF-to-cell topology for the selected DoFs should be built by iterating over all cells in the triangulation so that the one layer of cells in \(\Gamma_{\mathrm{N}}\) will be included.</p>

    <p><img src="/figures/2025-11-03-select-dofs-for-sobolev-spaces-on-subdomain_dirichlet-bc.png" alt="img" title="Select DoFs for the finite dimensional space $$\tilde{H}_h^{1/2}(\Gamma_{\mathrm{D}}^{\ast}) $$ of the extended Dirichlet boundary condition." /></p>
  </li>
  <li>
    <p>The extended Neumann boundary condition \(\tilde{g}_{\mathrm{N}}\) belongs to the space \(H^{-1/2}(\Gamma)\). The extension of \(g_{\mathrm{N}}\) from \(H^{-1/2}(\Gamma_{\mathrm{N}})\) to \(H^{-1/2}(\Gamma)\) is also not unique, which should be conforming with \(H^{-1/2}(\Gamma)\). Because there is no requirement on function continuity, we can simply extend of \(g_{\mathrm{N}}\) with zeros by selecting DoFs in \(\Gamma_{\mathrm{N}}\) from the DoF handler for the Neumann data, i.e. from the space \(H_h^{-1/2}(\Gamma)\). We denote this function space as \(\tilde{H}_h^{-1/2}(\Gamma_{\mathrm{N}})\).</p>

    <p>The DoF-to-cell topology for the selected DoFs is built by iterating over cells in \(\Gamma_{\mathrm{N}}\).</p>

    <p><img src="/figures/2025-11-03-select-dofs-for-sobolev-spaces-on-subdomain_neumann-bc.png" alt="img" title="Select DoFs for the finite dimension space $$\tilde{H}_h^{-1/2}(\Gamma_{\mathrm{N}}) $$ of the extended Neumann boundary condition." /></p>
  </li>
</ul>

<p>After selecting DoFs and building DoF-to-cell topologies for the above four types of spaces, \(\mathcal{H}\)-matrices can be built on corresponding subdomains for all the bilinear forms in Equation \eqref{eq:variational-form-with-subscripts}. The system of equations in matrix form is</p>

\[\begin{equation}
  \begin{aligned}
    \begin{pmatrix}
      \mathcal{V}_1 &amp; -\mathcal{K}_1 \\
      \mathcal{K}_1' &amp; \mathcal{D}_1
    \end{pmatrix}
    \begin{pmatrix}
      [\tilde{t}] \\ [\tilde{u}]
    \end{pmatrix}
    = \begin{pmatrix}
      \sigma \mathcal{M}_1 + \mathcal{K}_2 &amp; -\mathcal{V}_2 \\
      -\mathcal{D}_2 &amp; (1-\sigma) \mathcal{M}_2 - \mathcal{K}_2'
    \end{pmatrix}
    \begin{pmatrix}
      [\tilde{g}_{\mathrm{D}}] \\ [\tilde{g}_{\mathrm{N}}]
    \end{pmatrix},
  \end{aligned}
  \label{eq:matrix-form}
\end{equation}\]

<p>where \(\mathcal{K}_1'=\mathcal{K}_1^{\mathrm{T}}\), but \(\mathcal{K}_2' \neq \mathcal{K}_2^{\mathrm{T}}\), because they are constructed on different function spaces:</p>

\[\begin{equation}
  \mathcal{K}_2: \tilde{H}_h^{-1/2}(\Gamma_{\mathrm{D}}) \times \tilde{H}_h^{1/2}(\Gamma_{\mathrm{D}}^{\ast}), \mathcal{K}_2': \tilde{H}_h^{1/2}(\Gamma_{\mathrm{N}}) \times \tilde{H}_h^{-1/2}(\Gamma_{\mathrm{N}}).
\end{equation}\]

<p>N.B. When specifying the function spaces for a Galerkin matrix, we place the test space (related to matrix rows) before the trial space (related to matrix columns).</p>

<p>Meanwhile, \(\sigma \mathcal{M}_1\) will be directly assembled into \(\mathcal{K}_2\) and \((1-\sigma)\mathcal{M}_2\) directly built into \(-\mathcal{K}_2'\).</p>


  </div><a class="u-url" href="/math/2025/11/04/how-to-build-hmatrix-on-subdomain.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">止于至善</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Jihuan Tian</li><li><a class="u-email" href="mailto:jihuan_tian@hotmail.com">jihuan_tian@hotmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="/feed.xml"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#rss"></use></svg> <span>RSS</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>As regards numerical analysis, mathematical electromagnetism, Linux techniques and personal thoughts.</p>
      </div>
      <div class="footer-col">
        <p>The articles are under a <a href='http://creativecommons.org/licenses/by-nc-sa/4.0/'>Creative Commons Attribution License</a>. Copyright &copy; 2025 <a href="mailto:jihuan_tian@hotmail.com">Jihuan Tian</a>.</p>
      </div>
    </div>
  </div>

</footer>
</body>

</html>
